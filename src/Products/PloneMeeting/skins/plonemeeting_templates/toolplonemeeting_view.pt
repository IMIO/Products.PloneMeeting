<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en-US" lang="en-US"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="PloneMeeting">

  <body>
  <metal:title fill-slot="content-title">
    <h1 class="documentFirstHeading">
      <span i18n:translate="pm_configuration"/>
    </h1>
  </metal:title>
  <metal:fill fill-slot="content-core">
    <metal:body_macro define-macro="body"
       tal:define="isRealManager python: context.isManager(context, True);
                   mode string:view;">

    <tal:hideToNonManagers condition="python: isRealManager or context.isManager(context)">
      <p class="tool_pm_descr" i18n:translate="plonemeeting_descr"></p>

      <tal:comment replace="nothing">Meeting configurations</tal:comment>
      <a name="MeetingConfig"></a>
      <fieldset>
        <legend>
         <span i18n:translate="meeting_configurations"></span>
         <a href="#"
            title="add_object"
            i18n:attributes="title"
            tal:condition="isRealManager"
            tal:attributes="href string:${context/absolute_url}/createObject?type_name=MeetingConfig">
           <img src="#" tal:attributes="src string: $portal_url/new.png" />
         </a>
        </legend>
        <p class="discreet" i18n:translate="meeting_configurations_descr"></p><br />

        <fieldset tal:repeat="grouped_config python: context.getGroupedConfigs(as_items=True)">
          <legend tal:content="python:grouped_config[0][1]">Config group title</legend>
  
            <table class="vertical listing nosort" width="100%">
              <thead>
              <tr>
                <th class="nosort" i18n:translate="listingheader_title"></th>
                <th class="nosort" width="50px" i18n:translate="heading_is_active"></th>
                <th class="nosort" width="140px" i18n:translate="heading_actions"></th>
              </tr>
              </thead>
              <tbody>
              <tr tal:condition="python: not grouped_config[1]">
                <td colspan="3" align="center" i18n:translate="">no_meeting_config</td>
              </tr>
              <tal:loop repeat="obj python:grouped_config[1]">
              <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                              oddrow repeat/obj/odd;
                              classOddEven python: oddrow and 'even' or 'odd';"
                 tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
                 valign="top">
                <td><h5><a tal:attributes="href obj/absolute_url" tal:content="obj/getName"></a></h5>
                </td>
                <td i18n:domain="plone">
                  <span tal:condition="isActive" i18n:translate="">Yes</span>
                  <span tal:condition="not: isActive" i18n:translate="">No</span>
                </td>
                <td align="right">
                    <tal:actions replace="structure python: obj.restrictedTraverse('@@actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
                </td>
              </tr>
              </tal:loop>
              </tbody>
            </table>
        </fieldset>

      </fieldset>

    <tal:comment replace="nothing">MeetingGroups</tal:comment>
    <a name="MeetingGroup"></a>
     <fieldset>
        <legend><span i18n:translate="meeting_groups"></span>
          <img tal:attributes="src string: $portal_url/questionMark.png;
                               onClick python:'toggleDoc(\'groupDoc\')'"
               style="cursor:pointer"/>
            <a href="#"
               title="add_object"
               i18n:attributes="title"
               tal:condition="isRealManager"
               tal:attributes="href string:${context/absolute_url}/createObject?type_name=MeetingGroup">
              <img src="#" tal:attributes="src string: $portal_url/new.png" />
            </a>
        </legend>
        <div id="groupDoc" style="display:none">
            <p class="discreet" i18n:translate="meeting_groups_descr"></p>
        </div>
        <table class="vertical listing nosort" width="100%">
          <tr>
            <th class="nosort" i18n:translate="listingheader_title"></th>
            <th class="nosort" width="10%" i18n:translate="PloneMeeting_label_acronym"></th>
            <th class="nosort" width="50px" i18n:translate="heading_is_active"></th>
            <th class="nosort" width="140px" i18n:translate="heading_actions"></th>
          </tr>
          <tr tal:condition="python: not context.objectValues('MeetingGroup')">
            <td colspan="4" align="center" i18n:translate="">no_meeting_group</td>
          </tr>
          <tal:loop repeat="obj python: context.objectValues('MeetingGroup')">
          <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                          oddrow repeat/obj/odd;
                          classOddEven python: oddrow and 'even' or 'odd';"
             tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
             valign="top">
            <td>
              <h5><a tal:attributes="href obj/absolute_url" tal:content="obj/getName"></a></h5>
              <div class="discreet"
                   tal:define="descr obj/Description"
                   tal:condition="descr"
                   tal:content="descr">MeetingGroup description</div>
                  <tal:additionalInformations
                        define="context python: obj;
                                excludedFields python: ('id', 'description', 'title')">
                        <metal:addtionalInformations use-macro="here/@@pm-macros/additionalInformations" />
                  </tal:additionalInformations>
            </td>
            <td tal:content="obj/getAcronym"></td>
            <td i18n:domain="plone">
              <span tal:condition="isActive" i18n:translate="">Yes</span>
              <span tal:condition="not: isActive" i18n:translate="">No</span>
            </td>
            <td align="right">
                <tal:actions replace="structure python: obj.restrictedTraverse('@@actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
            </td>
          </tr>
          </tal:loop>
        </table>
      </fieldset>

      <!-- collective.documentgenerator configuration -->
      <fieldset>
        <legend>
           <span i18n:translate="documentgenerator_config"></span>
        </legend>
        <p class="discreet" i18n:translate="documentgenerator_config_descr">These parameters are now managed in the <a i18n:name="docgen_url" i18n:domain="collective.documentgenerator" i18n:translate="" tal:attributes="href string:${portal_url}/@@collective.documentgenerator-controlpanel">Document Generator settings</a>.</p><br />
      </fieldset>

      <!-- collective.documentviewer configuration -->
      <fieldset>
        <legend>
           <span i18n:translate="annexes_preview"></span>
        </legend>
        <p class="discreet" i18n:translate="annexes_preview_descr"></p><br />
        <tal:auto_convert_enabled condition="context/auto_convert_annexes">
          <p class="discreet" i18n:translate="annexes_preview_enabled">
            <span style='color: green;'>Annexes preview is enabled in the <a i18n:name="documentviewer_url" i18n:domain="collective.documentviewer" i18n:translate="heading_documentviewer_global_settings_form" href="" tal:attributes="href string:${portal_url}/@@global-documentviewer-settings">Global Document Viewer Settings</a>.</span>
          </p>
        </tal:auto_convert_enabled>
        <tal:auto_convert_enabled condition="not: context/auto_convert_annexes">
          <p class="discreet" i18n:translate="annexes_preview_disabled">
            <span style='color: green;'>Annexes preview is disabled in the <a i18n:name="documentviewer_url" i18n:domain="collective.documentviewer" i18n:translate="heading_documentviewer_global_settings_form" href="" tal:attributes="href string:${portal_url}/@@global-documentviewer-settings">Global Document Viewer Settings</a>.</span>
          </p>
        </tal:auto_convert_enabled>
      </fieldset>

      <!-- Misc -->
      <fieldset>
        <legend>
         <span i18n:translate="tool_plonemeeting_misc"></span>
        </legend>
        <table width="100%">
          <tr valign="top">
            <td tal:define="field python:here.getField('meetingFolderTitle')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td tal:define="field python:here.getField('functionalAdminEmail')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td tal:define="field python:here.getField('functionalAdminName')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
          </tr>
          <tr valign="top">
            <td tal:define="field python:here.getField('restrictUsers')">
                <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td tal:define="field python:here.getField('unrestrictedUsers')">
                <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td>
            </td>
          </tr>
          <tr valign="top">
            <td tal:define="field python:here.getField('extractTextFromFiles')">
                <span metal:use-macro="here/widgets/field/macros/view" /></td>
            <td tal:define="field python:here.getField('availableOcrLanguages')">
                <span metal:use-macro="here/widgets/field/macros/view" /></td>
            <td tal:define="field python:here.getField('defaultOcrLanguage')">
              <span metal:use-macro="here/widgets/field/macros/view" /></td>
          </tr>
          <tr valign="top">
            <td tal:define="field python:here.getField('enableUserPreferences')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td tal:define="field python:here.getField('modelAdaptations')">
              <span metal:use-macro="here/widgets/field/macros/view" /></td>
            <td></td>
            <td></td>
          </tr>
          <tr valign="top">
            <td tal:define="field python:here.getField('workingDays')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td tal:define="field python:here.getField('holidays')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td tal:define="field python:here.getField('delayUnavailableEndDays')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
          </tr>
          <tr valign="top">
            <td tal:define="field python:here.getField('configGroups')">
              <span metal:use-macro="here/widgets/field/macros/view" />
            </td>
            <td>
            </td>
            <td>
            </td>
          </tr>

        </table>
      </fieldset>

      <tal:comment replace="nothing">Display custom fields</tal:comment>
      <tal:customFields define="customFields python: context.getCustomFields(2)"
                        condition="customFields">
      <fieldset>
        <legend i18n:translate="">tool_plonemeeting_misc</legend>
        <table width="100%" class="discreet">
          <tr valign="top" tal:repeat="fieldLine customFields">
            <td tal:repeat="field fieldLine">
              <tal:thereIsAField condition="field">
                <metal:field use-macro="here/widgets/field/macros/view" />
              </tal:thereIsAField>
            </td>
          </tr>
        </table>
      </fieldset>
      </tal:customFields>

    <fieldset tal:condition="isRealManager">
      <legend i18n:translate="heading_actions"></legend>
      <p class="discreet" style="color: red;" i18n:translate="pm_tool_updates_warning">
      Warning: take care that launching these updates may take time, depending on the number of existing elements!  Do not launch during period of hig use!
      </p>
      <table class="configActions">
        <tr valign="top">
          <td>
            <form name="convertAnnexes" action="convertAnnexes">
            <input class="context" type="submit" name="convertAnnexes"
                   value="pm_convert_annexes" i18n:attributes="value"/>&nbsp;&nbsp;
            </form>
          </td>
          <td>
            <form name="updateAllLocalRolesForm" action="updateAllLocalRoles">
            <input class="context" type="submit" name="updateAllLocalRoles"
                   value="pm_update_all_local_roles" i18n:attributes="value"/>&nbsp;&nbsp;
            </form>
          </td>
        </tr>
      </table>
    </fieldset>

    <div metal:define-macro="folderlisting"></div>
    </tal:hideToNonManagers>

    </metal:body_macro>
  </metal:fill>
</body>
</html>
