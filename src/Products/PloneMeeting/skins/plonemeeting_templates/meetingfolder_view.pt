<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en" lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

  <head>
    <div metal:fill-slot="top_slot">
    <metal:block metal:use-macro="here/global_defines/macros/defines" />
    <div tal:define="member context/@@plone_portal_state/member;
                     dummy python:request.set(test(member.has_permission('Manage portal content', here), 'enable_border', 'disable_border'), 1);" />
    </div>
  </head>

  <body>

    <div metal:fill-slot="main">
    <metal:main-macro define-macro="main">
    <metal:contentsmacro define-macro="contents"
         tal:define="contentTypes here/getAllowedTypes;
                     contentFilter contentFilter|request/contentFilter|nothing;
                     b_size b_size|request/b_size|python:100;
                     b_start python:0;
                     b_start request/b_start | b_start;
                     results python: here.restrictedTraverse('@@folderListing')(batch=True, b_size=b_size, b_start=b_start);
                     Batch python:modules['Products.CMFPlone'].Batch;
                     batch python: Batch(results, b_size, b_start);
                     here_url context/absolute_url;
                     portal context/@@plone_portal_state/portal;
                     normalizeString nocall:context/@@plone/normalizeString;
                     toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                     tool python: context.portal_plonemeeting;
                     userIsAmongCreators python: tool.userIsAmong('creators');
                     hasItemTemplates python: context.restrictedTraverse('@@createitemfromtemplate').getTemplateItems()">

        <h1>
          <span tal:attributes="class string:contenttype-${context/portal_type/lower}" tal:content="context/Title" tal:omit-tag="">Directory Id</span>
        </h1>

      <!-- Add Item pulldown -->
      <div>
       <metal:add_button define-macro="add_button"
                         tal:define="num_types python:len(contentTypes);"
                         tal:condition="userIsAmongCreators">

            <label for="select_add_item">
              <span i18n:domain="PloneMeeting" i18n:translate="">Select an item to add</span>
            </label>

            <form action='createObject' tal:attributes="action string:${context/absolute_url}/createObject;" method="post" name="quickadd">

<tal:comment replace="nothing">Disabled the button until a good value is selected (not the 'Select' value)</tal:comment>
<tal:activate_deactivate_add_button_js
define="activated_label python: context.utranslate('label_create_an_element', domain='PloneMeeting');
        deactivated_label python: context.utranslate('label_choose_element_in_list', domain='PloneMeeting')"
replace="structure string:<script type='text/javascript'>
function disable_select(value){
if(value.innerHTML.indexOf('pixel.gif') != -1){
var elt=document.getElementById('select_add_item_button');
elt.disabled = true;
elt.value='$deactivated_label'
elt.className = 'context input_disabled';}
else
{
var elt=document.getElementById('select_add_item_button');
elt.className='context';
elt.value='$activated_label'
elt.disabled = false;}
}
</script>"></tal:activate_deactivate_add_button_js>

  <tal:comment replace="nothing">Definition of the predefined titles</tal:comment>
  <script language="JavaScript">
    var typeNameBox = new Object();
    typeNameBox["button"] = "idButton1";
    typeNameBox["box"] = "idBox1";
    typeNameBox["image"] = "idImage1";
    typeNameBox["buttonText"] = "idButtonText1";
    typeNameBox["hidden"] = "idHidden1";
    ploneMeetingSelectBoxes["typeNameBox"] = typeNameBox;
  </script>

    <tal:comment replace="nothing">Listbox for selecting a file type</tal:comment>
    <div class="field">
      <div class="ploneMeetingSelectContainer" style="width: 300px">
        <input type="hidden" tal:attributes="value request/type_name|nothing" id="idHidden1" name="type_name">
        <tal:comment replace="nothing">Select button</tal:comment>
        <div class="ploneMeetingSelectButton ploneMeetingSelectDropdownIcon" id="idButton1"
             onclick="displayPloneMeetingSelectBox('typeNameBox')">
          <span tal:condition="python: (request.has_key('type_name')) and request['type_name']">
            <span tal:define="num python: 1">
              <img id="idImage1" tal:attributes="src python: type_name.getIcon();"
                   alt="" class="ploneMeetingSelectImage" />
              <span id="idButtonText1" tal:content="python: type_name.Title()" class="ploneMeetingRef"></span>
            </span>
          </span>
          <span tal:condition="python: (not request.has_key('type_name')) or (not request['type_name'])">
            <img id="idImage1" src="pixel.gif" class="ploneMeetingSelectImage"/>
            <span id="idButtonText1" class="ploneMeetingRef" i18n:domain="PloneMeeting" i18n:translate="">make_a_choice</span>
          </span>
        </div>

        <tal:comment replace="nothing">The listbox</tal:comment>
        <div class="ploneMeetingSelectBox" id="idBox1"
             tal:define="global num python: 0;" style="width: 300px">
          <p tal:define='choose python:here.utranslate("make_a_choice", domain="PloneMeeting")'
             tal:attributes="onclick python:'hidePloneMeetingSelectBox(\'typeNameBox\', \'idImage10\', \'' + choose + '\', \'\', \'\');; ploneMeetingSelectOnMouseOutItem(this);; disable_select(this)'"
             class="ploneMeetingSelectItem"
             onmouseover="ploneMeetingSelectOnMouseOverItem(this)"
             onmouseout="ploneMeetingSelectOnMouseOutItem(this)"
             onclick="hidePloneMeetingSelectBox('typeNameBox','idImage10', '--- Choisissez ---', '', ''); ploneMeetingSelectOnMouseOutItem(this)"
             id="idButtonText10">
            <img id="idImage10" src="pixel.gif" class="ploneMeetingSelectImage" />
            <span i18n:translate="" i18n:domain="PloneMeeting">make_a_choice</span>
          </p>
          <tal:loop repeat="type_name python: context.allowedContentTypes()">
           <p tal:define="global num python: num + 1;
                          ftName python: context.utranslate(type_name.getId())"
             style="width: 277px;"
             class="ploneMeetingSelectItem"
             onmouseover="ploneMeetingSelectOnMouseOverItem(this)"
             onmouseout="ploneMeetingSelectOnMouseOutItem(this)"
             onclick="hidePloneMeetingSelectBox('typeNameBox','idImage1', 'value1', 'predefined_title1'); ploneMeetingSelectOnMouseOutItem(this)"
             tal:attributes="class string:ploneMeetingSelectItem icons-imaged-dropdown contenttype-${type_name/id/lower};
                             onclick python:'hidePloneMeetingSelectBox(\'typeNameBox\', \'idImage1' + str(num) + '\', \'' + ftName + '\', \'' + type_name.getId() + '\', \'' + type_name.Title() + '\');; ploneMeetingSelectOnMouseOutItem(this);; disable_select(this)';">
            <span tal:content="ftName" />
           </p>
          </tal:loop>
        </div>
      </div>
     </div>
     &nbsp;
     <div style="float: left; padding-left: 0.5em;">
            <input class="context input_disabled"
                   id="select_add_item_button"
                   type="submit"
                   name="add_button"
                   disabled
                   value="label_choose_element_in_list"
                   i18n:domain="PloneMeeting"
                   i18n:attributes="value" />
    </div>
    <div tal:condition="hasItemTemplates"
         style="float: left; padding-left: 0.5em;">
        <a class="link-overlay-pm"
           style="display: inline; padding-left: 0;"
           href="@@createitemfromtemplate"
           tal:attributes="href string:${context/absolute_url}/createitemfromtemplate">
            <form>
                <input type="submit" size="17"
                       value="Create an item from a template"
                       tal:attributes="value string:create_meeting_item_from"
                       i18n:domain="PloneMeeting"
                       i18n:attributes="value" class="hsButton">
            </form>
        </a>
    </div>
    </form>
    <br />
       </metal:add_button>
      </div>

      <form name="folderContentsForm"
            method="post"
            action="folder_object"
            tal:attributes="action here_url">

        <!-- Do not show the up one level link if we are at the root of a meetingConfigFolder -->
            <tal:upOneLevel define="parent_url python:here.navigationParent(here, fallThroughDefaultPage=False, checkPermissions=['View'])"
                            condition="python: parent_url and not context.hasProperty('meeting_config')">
            <br />
            <a href=""
               class="link-parent"
               tal:attributes="href string:${parent_url}"
               i18n:translate="go_to_parent_url">
                Up one level
            </a>
            <br /><br />
            </tal:upOneLevel>

            <p class="documentDescription"
               tal:content="here/Description"
               tal:condition="here/Description">
                Description
            </p>

        <p class="discreet"
           tal:condition="python: not batch and userIsAmongCreators"
           i18n:translate="description_no_visible_items_add_paste">
           This folder has no visible items. To add content, press the
           add button, or paste content from another location.
        </p>
        <p class="discreet"
           tal:condition="python: not batch and not userIsAmongCreators"
           i18n:translate="description_only_see_visible_items" i18n:domain="PloneMeeting">
           You are just able to see visible elements here. Please consult the 'manage' box here opposite.
        </p>
        <metal:override define-slot="override_slot">
           <tal:comment replace="nothing">
              Slot for overiding batching mechanism including batch size and
              other parameters
           </tal:comment>
        </metal:override>
        <metal:listing define-macro="folder_listing"
                       tal:define="use_view_action site_properties/typesUseViewActionInListings|python:();">

        <div class="visualClear"><!-- --></div>

        <!-- Navigation -->
        <div metal:use-macro="context/batch_macros/macros/navigation" />

          <table class="listing"
                 summary="Content listing"
                 i18n:attributes="summary summary_content_listing;">
            <thead>
              <metal:block tal:condition="batch">
                <tr>
                  <th class="nosort">
                      <input class="noborder"
                             type="checkbox"
                             src="select_all_icon.gif"
                             name="selectButton"
                             title="Select all items"
                             onClick="toggleSelect(this,'paths:list');"
                             tal:attributes="src string:$portal_url/select_all_icon.gif"
                             alt="Select all items"
                             i18n:attributes="title label_select_all_items; alt label_select_all_items;"
                  />
                  </th>
                  <th class="nosort">&nbsp;<tal:title i18n:translate="listingheader_title"
                      >Title</tal:title>&nbsp;</th>
                  <metal:header_slot metal:define-slot="listingheader">
                  <th class="nosort">&nbsp;<tal:size i18n:translate="listingheader_size"
                      >Size</tal:size>&nbsp;</th>
                  <th class="nosort">&nbsp;<tal:modified i18n:translate="listingheader_modified"
                      >Modified</tal:modified>&nbsp;</th>
                  <th class="nosort">&nbsp;<tal:state i18n:translate="listingheader_status"
                      >State</tal:state>&nbsp;</th>
                  </metal:header_slot>
                </tr>
              </metal:block>
            </thead>

            <metal:block tal:condition="batch">
            <tbody tal:define="arrowUp portal/arrowUp.gif;
                               arrowDown portal/arrowDown.gif;
                               getRelativeContentURL nocall:portal/portal_url/getRelativeContentURL;
                               showColors tool/showColorsForUser;
                               ">
                <tal:items tal:repeat="item batch">
                   <tr tal:define="item                 item/getObject;
                                   item_url             item/absolute_url;
                                   item_id              item/getId;
                                   item_path            python:'/'.join(item.getPhysicalPath());
                                   item_title_or_id     python: item.meta_type=='MeetingItem' and tool.getColoredLink(item, showColors) or item.Title();
                                   item_description     item/Description;
                                   item_type            item/portal_type;
                                   item_size            item/getObjSize;
                                   item_modified        item/ModificationDate;
                                   item_type_class      python:'contenttype-' + normalizeString(item_type);
                                   item_wf_state        item/review_state|python: context.portal_workflow.getInfoFor(item, 'review_state', '');
                                   item_state_title     python:context.portal_workflow.getTitleForStateOnType(item_wf_state, item_type);
                                   item_wf_state_class  python:'state-' + normalizeString(item_wf_state);
                                   item_use_view        python:item_type in use_view_action;
                                   item_rel_url         python: getRelativeContentURL(item);"
                       tal:attributes="id item_id;" >

                       <tal:comment replace="nothing">
                            * We have to check if the browserDefault stuff is really necessary
                            * Create title_or_id metadata in the catalog (why not just use item.Title or item.getId? (alecm))
                       </tal:comment>

                       <td>
                           <input type="checkbox"
                                  class="noborder"
                                  name="paths:list" id="#"
                                  value="#"
                                  tal:attributes="value   item_path;
                                                  id      string:cb_$item_id;
                                                  checked python:test(request.get('ids_checked', False), 'checked', None);
                                                  alt     string:Select $item_title_or_id;
                                                  title   string:Select $item_title_or_id" />
                      <input type="hidden" name="obj_paths:list" value="#"
                             tal:attributes="value item_rel_url" />

                    </td>
                    <td tal:define="url python:test(item_use_view, item_url+'/view', item_url)">
                        <a href="#" tal:attributes="href  url;
                                                  title string: $item_type: $item_description;
                                                  class string:$item_wf_state_class visualIconPadding;">
                        <span tal:attributes="class item_type_class">
                            <span tal:content="structure item_title_or_id">
                              Item Title
                            </span>
                        </span>
                        </a>

                        <span class="state-expired"
                              tal:condition="python:portal.isExpired(item)"
                              i18n:translate="time_expired">expired</span>
                    </td>

                    <metal:item_slot metal:define-slot="item_display">
                    <td>
                      <span tal:condition="not: item_size"> &nbsp; </span>
                      <span tal:condition="python:item_size>0"
                            tal:content="item_size"> size </span>
                    </td>
                    <td tal:content="python:toLocalizedTime(item_modified, long_format=1)">
                        08/19/2001 03:01 AM
                    </td>
                    <td>
                        <span i18n:translate=""
                              tal:condition="item_state_title"
                              tal:content="item_state_title"
                              tal:attributes="class item_wf_state_class" />
                        <span tal:condition="not: item_state_title">&nbsp;</span>
                    </td>
                    </metal:item_slot>
                   </tr>
                </tal:items>
            </tbody>
            </metal:block>
            </table>
            <!-- Navigation -->
            <div metal:use-macro="context/batch_macros/macros/navigation" />
        </metal:listing>

        <metal:buttons define-macro="folder_buttons">
        <br />
        <tal:buttons tal:repeat="button context/listFolderButtonsActions|nothing">
          <input class="context"
                 type="submit"
                 name=""
                 value=""
                 tal:condition="python:(batch or here.cb_dataValid and button['id'] in ['paste', 'paste_plonemeeting', ]) and not (button['id'] in ['cut','copy','paste'])"
                 i18n:attributes="value"
                 tal:attributes="value button/title;
                                 name button/url;
                                 class python:test((button['id'] in ['paste_plonemeeting', 'paste', 'plonemeeting_delete', ]), 'standalone', 'context');" />
        </tal:buttons>
        </metal:buttons>
      </form>

    </metal:contentsmacro>
    </metal:main-macro>
    </div>
  </body>
</html>
