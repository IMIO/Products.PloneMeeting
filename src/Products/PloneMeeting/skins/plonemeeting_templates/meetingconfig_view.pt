<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="PloneMeeting">

  <body >
  <metal:title fill-slot="content-title">
    <h1 class="documentFirstHeading">
        <span tal:content="context/getName"></span>
    </h1>
  </metal:title>
  <metal:description fill-slot="content-description">
   <tal:comment replace="nothing">Just hide the description as shown by default by Plone</tal:comment>
  </metal:description>

  <metal:fill fill-slot="content-core">
    <metal:main_macro define-macro="body"
                      tal:define="isRealManager python: context.portal_plonemeeting.isManager(context, True);
                                  mode python:'view';
                                  pageName request/pageName|string:default;
                                  member context/portal_plonemeeting/getUser;
                                  schematas here/Schemata;
                                  fieldsets python:[key for key in schematas.keys() if (key != 'metadata')];">

    <tal:hideToNonManagers condition="python: isRealManager or context.portal_plonemeeting.isManager(context)">

    <span tal:repeat="fieldset python: fieldsets + ['users', 'doc']">
      [
      <tal:otherFieldset condition="python: pageName!=fieldset"><a
        tal:attributes="href python:here.absolute_url()+'?pageName=%s'%fieldset" tal:condition="python: pageName!=fieldset">
        <span tal:content="fieldset" i18n:translate=""></span></a>
      </tal:otherFieldset>
      <tal:currentFieldset condition="python: pageName==fieldset"><b><span
        tal:content="fieldset" i18n:translate=""></span></b>
      </tal:currentFieldset>
      <tal:edit condition="python: fieldset in fieldsets and schematas[fieldset].editableFields(here, visible_only=True)">
      <input type="image" title="Edit" i18n:attributes="title"
             style="cursor:pointer" class="imageInput"
             tal:attributes="src string: $portal_url/edit.gif;
                             onClick python: 'href: window.location=\'%s/base_edit?fieldset=%s\'' % (context.absolute_url(), fieldset)"/>
    </tal:edit>]
    </span><br/><br/>

    <tal:mainConfig condition="python: pageName=='default'">
      <table width="100%" class="discreet">
        <tr valign="top">
          <td tal:define="field python:here.getField('budgetDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('defaultMeetingItemMotivation')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="25%" tal:define="field python:here.getField('places')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('folderTitle')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <!-- I cannot use the standard macro for displaying this field because the
               widget condition prevents the widget from being displayed. -->
          <td tal:define="field python:here.getField('shortName')">
            <b i18n:translate="PloneMeeting_label_shortName"></b>:
            <span tal:content="context/getShortName"/>
          </td>
          <td tal:define="field python:here.getField('isDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemIconColor')">
            <span metal:use-macro="here/widgets/field/macros/view" />
            <img style="position: absolute; margin-top: -20px;" src="#" tal:attributes="src string:${portal_url}/${here/getItemIconColorName}" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('lastMeetingNumber')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('yearlyInitMeetingNumber')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('configVersion')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemCreatedOnlyUsingTemplate')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('enableAnnexToPrint')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('annexToPrintDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('annexDecisionToPrintDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('annexAdviceToPrintDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
      </table>

    <tal:comment replace="nothing">Display custom fields</tal:comment>
    <tal:customFields define="customFields python: context.getCustomFields(2)"
                      condition="customFields">
    <br/>
    <fieldset>
      <legend i18n:translate="">tool_plonemeeting_misc</legend>
      <table width="100%" class="discreet">
        <tr valign="top" tal:repeat="fieldLine customFields">
          <td tal:repeat="field fieldLine">
            <tal:thereIsAField condition="field">
              <metal:field use-macro="here/widgets/field/macros/view" />
            </tal:thereIsAField>
          </td>
        </tr>
      </table>
    </fieldset>
    </tal:customFields>

    <fieldset tal:condition="isRealManager">
      <legend i18n:translate="heading_actions"></legend>
      <p class="discreet" style="color: red;" i18n:translate="pm_tool_updates_warning">
      Warning: take care that launching these updates may take time, depending on the number of existing elements!  Do not launch during period of hig use!
      </p>
      <table class="meetingConfigActions">
        <tr valign="top">
          <td width=50%>
            <form name="updateAnnexConfidentialityForm" action="updateAnnexConfidentiality">
            <input class="context"
                   type="submit" name="updateAnnexConfidentiality"
                   value="pm_update_annex_confidentiality"
                   onclick="javascript:event.preventDefault(); if (confirm(window.eval('are_you_sure'))) {document.forms['updateAnnexConfidentialityForm'].submit();}"
                   i18n:attributes="value"/>&nbsp;&nbsp;
            </form>
            <p class="discreet" style="color: red;" i18n:translate="pm_update_annex_confidentiality_warning">
                Warning: the action 'Initialize existing annexes confidentiality' will initialize every existing annex confidentiality to what is defined as default value in this meeting configuration (check the 'Advices and access' tab).
            </p>
          </td>
          <td width=50%>
            <form name="updateAdviceConfidentialityForm" action="updateAdviceConfidentiality">
            <input class="context"
                   type="submit"
                   name="updateAdviceConfidentiality"
                   value="pm_update_advice_confidentiality"
                   onclick="javascript:event.preventDefault(); if (confirm(window.eval('are_you_sure'))) {document.forms['updateAdviceConfidentialityForm'].submit();}"
                   i18n:attributes="value"/>&nbsp;&nbsp;
            </form>
            <p class="discreet" style="color: red;" i18n:translate="pm_update_advice_confidentiality_warning">
                Warning: the action 'Initialize existing advices confidentiality' will initialize every existing advice confidentiality to what is defined as default value in this meeting configuration (check the 'Advices and access' tab).
            </p>
          </td>
        </tr>
      </table>
    </fieldset>

    </tal:mainConfig>

    <tal:assembly_and_signatures condition="python: pageName=='assembly_and_signatures'">
      <p i18n:translate="meetingconfig_assembly_and_signatures_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%">
            <span class="warningInMeetingConfig" i18n:translate="" tal:condition="python: not 'assembly' in context.getUsedMeetingAttributes()">
              The field here above is not used, check the 'users' tab.
            </span>
            <tal:comment replace="nothing">We do not use the widget macro to be able to render 'assembly' using mimetype='text/x-html-safe'</tal:comment>
            <label class="formQuestion"><span i18n:translate="PloneMeeting_label_assembly"></span>:</label>
            <span tal:replace="structure python: context.getAssembly(mimetype='text/x-html-safe') or '-'"/>
          </td>
          <td width="34%">
            <span class="warningInMeetingConfig" i18n:translate="" tal:condition="python: not 'assembly' in context.getUsedMeetingAttributes()">
              The field here above is not used, check the 'users' tab.
            </span>
            <tal:comment replace="nothing">We do not use the widget macro to be able to render 'signatures' using mimetype='text/x-html-safe'</tal:comment>
            <label class="formQuestion"><span i18n:translate="PloneMeeting_label_signatures"></span>:</label>
            <span tal:replace="structure python: context.getSignatures(mimetype='text/x-html-safe') or '-'"/>
          </td>
          <td width="33%" tal:define="field python:here.getField('certifiedSignatures')">
            <span class="warningInMeetingConfig" i18n:translate="" tal:condition="python: not 'assembly' in context.getUsedMeetingAttributes()">
              The field here above is not used, check the 'users' tab.
            </span>
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
      </table>
    </tal:assembly_and_signatures>

    <tal:data condition="python: pageName=='data'">
      <p i18n:translate="meetingconfig_data_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('usedItemAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('historizedItemAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('recordItemHistoryStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('usedMeetingAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('historizedMeetingAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('recordMeetingHistoryStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('useGroupsAsCategories')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('toDiscussSetOnItemInsert')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('toDiscussDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('toDiscussLateDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('toDiscussShownForLateItems')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemReferenceFormat')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('insertingMethodsOnAddItem')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('allItemTags')">
            <b i18n:translate="PloneMeeting_label_allItemTags"></b>:
            <span tal:content="python: ', '.join(context.getAllItemTags().split('\n'))" />
          </td>
          <td tal:define="field python:here.getField('sortAllItemTags')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('listTypes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('xhtmlTransformFields')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('xhtmlTransformTypes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('publishDeadlineDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('freezeDeadlineDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('preMeetingDateDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('useUserReplacements')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
          <td></td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('meetingConfigsToCloneTo')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemAutoSentToOtherMCStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemManualSentToOtherMCStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
      </table>

      <tal:comment replace="nothing">Annex types</tal:comment>
      <a name="meetingfiletypes"></a>
      <fieldset>
        <legend>
         <span i18n:translate="MeetingFileTypes"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:attributes="onClick python: 'href: window.location=\'%s/meetingfiletypes/createObject?type_name=MeetingFileType\'' % context.absolute_url();
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"
                tal:condition="isRealManager"/>
        </legend>
        <p class="discreet" i18n:translate="meeting_file_types_descr"></p><br />
          <table class="listing nosort" align="right" width="100%"
                 tal:define="fFolder python:context.meetingfiletypes;
                             fFolderUrl fFolder/absolute_url">
            <tr>
              <th class="plain" i18n:translate="listingheader_title">Title</th>
              <th width="200px" i18n:translate="PloneMeeting_label_relatedTo">Related to</th>
              <th width="50px" i18n:translate="heading_is_active">Active?</th>
              <th width="130px" i18n:translate="heading_actions">Actions</th>
            </tr>
            <tr tal:condition="python: not fFolder.objectValues('MeetingFileType')">
              <td colspan="3" align="center" i18n:translate="">no_meeting_file_type</td>
            </tr>
            <tal:loop repeat="obj python:fFolder.objectValues('MeetingFileType')">
            <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                            oddrow repeat/obj/odd;
                            classOddEven python: oddrow and 'even' or 'odd';" valign="top"
                tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
                class="#">
                <td><img tal:attributes="src python: obj.absolute_url() + '/at_download/theIcon'"/>&nbsp;
                    <a tal:attributes="href obj/absolute_url" tal:content="obj/getName"></a>
                    <div class="discreet" tal:define="descr obj/Description" tal:condition="descr" tal:content="descr"></div>
                    <tal:additionalInformations
                        define="context python: obj;
                                excludedFields python: ('id', 'description', 'title', 'theIcon', 'relatedTo')">
                        <metal:addtionalInformations use-macro="here/@@pm-macros/additionalInformations" />
                    </tal:additionalInformations>
                </td>
                <td>
                    <span i18n:translate="" tal:content="string:meetingfiletype_related_to_${obj/relatedTo}">Related to</span>
                </td>
                <td i18n:domain="plone">
                    <span tal:condition="isActive" i18n:translate="">Yes</span>
                    <span tal:condition="not: isActive" i18n:translate="">No</span>
                </td>
                <td align="center">
                    <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
                </td>
            </tr>
            </tal:loop>
            </table>

      </fieldset>

      <tal:comment replace="nothing">Categories</tal:comment>
      <a name="categories"></a>
      <fieldset>
        <legend>
         <span i18n:translate="Categories"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:attributes="onClick python: 'href: window.location=\'%s/categories/createObject?type_name=MeetingCategory\'' % context.absolute_url();
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"
                tal:condition="isRealManager"/>
        </legend>
        <p class="discreet" i18n:translate="categories_descr"></p><br />
        <table tal:define="cFolder python:context.categories;
                           cFolderUrl cFolder/absolute_url"
               class="listing nosort" align="right" width="100%">
          <tr>
            <th i18n:translate="listingheader_title">Title</th>
            <th width="50px" i18n:translate="heading_is_active">Active?</th>
            <th width="130px" i18n:translate="heading_actions">Actions</th>
          </tr>
          <tr tal:condition="python: not cFolder.objectValues('MeetingCategory')">
            <td colspan="3" align="center" i18n:translate="">no_category</td>
          </tr>
          <tal:loop repeat="obj python: cFolder.objectValues('MeetingCategory')">
          <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                            oddrow repeat/obj/odd;
                            classOddEven python: oddrow and 'even' or 'odd';" valign="top"
                tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
                class="#">
            <td>
                <a tal:attributes="href obj/absolute_url" tal:content="obj/getName"></a>
                <div class="discreet" tal:define="descr obj/Description" tal:condition="descr" tal:content="descr"></div>
                <tal:additionalInformations
                    define="context python: obj;
                            excludedFields python: ('id', 'description', 'title')">
                    <metal:addtionalInformations use-macro="here/@@pm-macros/additionalInformations" />
                </tal:additionalInformations>
            </td>
            <td i18n:domain="plone">
              <span tal:condition="isActive" i18n:translate="">Yes</span>
              <span tal:condition="not: isActive" i18n:translate="">No</span>
            </td>
            <td align="right">
              <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
            </td>
          </tr>
          </tal:loop>
        </table>
      </fieldset>

      <tal:comment replace="nothing">Classifiers</tal:comment>
      <a name="classifiers"></a>
      <fieldset>
        <p class="discreet" i18n:translate="classifiers_descr"></p><br />
        <legend>
         <span i18n:translate="Classifiers"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:attributes="onClick python: 'href: window.location=\'%s/classifiers/createObject?type_name=MeetingCategory\'' % context.absolute_url();
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"
                tal:condition="isRealManager"/>
        </legend>
        <table tal:define="cFolder python:context.classifiers;
                           cFolderUrl cFolder/absolute_url"
               class="listing nosort" align="right" width="100%">
          <tr>
            <th class="nosort" i18n:translate="listingheader_title">Title</th>
            <th class="nosort" width="20%" i18n:translate="PloneMeeting_label_categoryId">Category id</th>
            <th class="nosort" width="50px" i18n:translate="heading_is_active">Active?</th>
            <th class="nosort" width="130px" i18n:translate="heading_actions">Actions</th>
          </tr>
          <tr tal:condition="python: not cFolder.objectValues('MeetingCategory')">
            <td colspan="4" align="center" i18n:translate="">no_classifier</td>
          </tr>
          <tal:loop repeat="obj python:cFolder.objectValues('MeetingCategory')">
          <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                            oddrow repeat/obj/odd;
                            classOddEven python: oddrow and 'even' or 'odd';" valign="top"
                tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
                class="#">
            <td tal:define="descr obj/Description">
                <a tal:attributes="href obj/absolute_url" tal:content="obj/getName"></a>
                <div class="discreet" tal:condition="descr" tal:content="descr"></div>
                <tal:additionalInformations
                    define="context python: obj;
                            excludedFields python: ('id', 'description', 'title')">
                    <metal:addtionalInformations use-macro="here/@@pm-macros/additionalInformations" />
                </tal:additionalInformations>
            </td>
            <td tal:content="obj/getCategoryId"></td>
            <td i18n:domain="plone">
              <span tal:condition="isActive" i18n:translate="">Yes</span>
              <span tal:condition="not: isActive" i18n:translate="">No</span>
            </td>
            <td align="right">
              <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
            </td>
          </tr>
          </tal:loop>
        </table>
      </fieldset>

      <!-- Recurring items -->
      <a name="recurringitems"></a>
      <fieldset>
        <legend>
         <span i18n:translate="RecurringItems"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:define="itemType python: context.getItemTypeName(configType='MeetingItemRecurring')"
                tal:attributes="onClick python: 'href: window.location=\'%s/recurringitems/createObject?type_name=%s\'' % (context.absolute_url(), itemType);
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"
                tal:condition="isRealManager"/>
        </legend>
        <p class="discreet" i18n:translate="recurring_items_descr"></p><br />
        <table class="listing nosort" align="right" width="100%"
               tal:define="rFolder python:context.recurringitems;
                           rFolderUrl rFolder/absolute_url;">
          <tr>
            <th class="nosort" width="50%" i18n:translate="listingheader_title">Title</th>
            <th class="nosort" i18n:translate="PloneMeeting_label_meetingTransitionInsertingMe">Meeting transition inserting me</th>
            <th class="nosort" width="130px" i18n:translate="heading_actions">Actions</th>
          </tr>
          <tr tal:condition="python: not rFolder.objectValues('MeetingItem')">
            <td colspan="5" align="center" i18n:translate="">no_recurring_item</td>
          </tr>
          <tal:loop repeat="obj python: context.getRecurringItems(onlyActive=False)">
          <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                          oddrow repeat/obj/odd;
                          classOddEven python: oddrow and 'even' or 'odd';" valign="top"
                tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
                class="#">
            <td><a tal:attributes="href obj/absolute_url" tal:content="obj/getName"></a></td>
            <td><span tal:content="python: obj.getMeetingTransitionInsertingMe() or '-'" i18n:domain="plone" i18n:translate="">Transition inserting me</span></td>
            <td align="right">
              <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
            </td>
          </tr>
          </tal:loop>
        </table>
      </fieldset>

      <!-- Item templates -->
      <a name="itemTemplates"></a>
      <fieldset>
        <legend>
         <span i18n:translate="Item templates"></span>
        </legend>
        <p class="discreet" i18n:translate="item_templates_descr"></p>
        <p><img src="manage.png"
                tal:attributes="src string:${portal_url}/manage.png;"/>&nbsp;<a href="itemtemplates" i18n:translate="">Manage item templates</a></p>
      </fieldset>
    </tal:data>

    <tal:workflow condition="python: pageName=='workflow'">
      <p i18n:translate="meetingconfig_workflow_descr" class='pageNameDescr'></p><br />
      <p i18n:translate="warning_meetingconfig_workflow_descr" style="color: red;">
        DO NOT CHANGE PARAMETERS DEFINFED IN THIS SECTION UNLESS YOU ARE REALLY SURE WHAT YOU ARE DOING!
      </p><br />
      
      <table width="100%" class="discreet" tal:define="wfTool python: context.portal_workflow">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('itemWorkflow')">
            <span metal:use-macro="here/widgets/field/macros/view" />
            <span style="color: red;" tal:content="python: wfTool.getWorkflowsFor(context.getItemTypeName())[0].getId()"></span>
          </td>
          <td width="34%" tal:define="field python:here.getField('itemConditionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('itemActionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('meetingWorkflow')">
            <span metal:use-macro="here/widgets/field/macros/view" />
            <span style="color: red;" tal:content="python: wfTool.getWorkflowsFor(context.getMeetingTypeName())[0].getId()"></span>
          </td>
          <td tal:define="field python:here.getField('meetingConditionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingActionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('workflowAdaptations')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemDecidedStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('transitionsToConfirm')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('transitionsForPresentingAnItem')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('onTransitionFieldTransforms')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('onMeetingTransitionItemTransitionToTrigger')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('meetingPresentItemWhenNoCurrentMeetingStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
          <td></td>
        </tr>
      </table>
    </tal:workflow>

    <tal:gui condition="python: pageName=='gui'">
      <p i18n:translate="meetingconfig_gui_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td tal:define="field python:here.getField('itemColumns')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingColumns')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemsListVisibleColumns')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('dashboardItemsListingsFilters')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('dashboardMeetingAvailableItemsFilters')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('dashboardMeetingLinkedItemsFilters')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('itemsListVisibleFields')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('toDoListSearches')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('maxShownMeetings')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('maxShownListings')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('maxShownAvailableItems')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('maxShownMeetingItems')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
      </table>

      <!-- Searches -->
      <a name="searches"></a>
      <fieldset>
        <legend>
          <span i18n:translate="Searches">Searches</span>
        </legend>
        <p class="discreet" i18n:translate="searches_descr"></p>
        <p><img src="manage.png"
                tal:attributes="src string:${portal_url}/manage.png;"/>&nbsp;
            <a href="searches/folder_contents" i18n:translate="">
                Manage dashboard
            </a>
        </p>
        <tal:searchesCategories repeat="cFolder python: context.searches.objectValues()">
            <table class="listing nosort" style="text-align: right;" width="100%"
                   tal:define="cFolderUrl cFolder/absolute_url" width="100%;">
              <tr>
                <th class="nosort" width="200px">
                    <span tal:content="cFolder/Title">Folder title</span>
                    <input type="image"
                           style="cursor:pointer"
                           class="imageInput"
                           tal:attributes="onClick python: 'href: window.location=\'%s/createObject?type_name=DashboardCollection\'' % cFolderUrl;
                                 src string: $portal_url/plus.png"
                 title="add_object" i18n:attributes="title"
                 tal:condition="isRealManager"/>
                </th>
                <th class="nosort" width="400px" i18n:translate="heading_criteria">Criteria</th>
                <th class="nosort" i18n:translate="">Condition</th>
                <th class="nosort" width="50px" i18n:translate="heading_is_active">Active?</th>
                <th class="nosort" width="130px" i18n:translate="heading_actions">Actions</th>
              </tr>
              <tr tal:condition="python: not cFolder.objectValues('DashboardCollection')">
                <td colspan="5" align="center" i18n:translate="">no_collection_folder</td>
              </tr>
              <tal:loop repeat="obj python:cFolder.objectValues('DashboardCollection')">
              <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                              oddrow repeat/obj/odd;
                              classOddEven python: oddrow and 'even' or 'odd';"
                  tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
                  valign="top">
                <td>
                  <a tal:attributes="href obj/absolute_url" tal:content="obj/Title">Collection title</a>
                  <div class="discreet" tal:define="descr obj/Description" tal:condition="descr" tal:content="descr">Collection description</div>
                </td>
                <td>
                  <span tal:content="obj/query">Criteria</span>
                </td>
                <td style="word-break: break-all;" >
                  <span tal:content="obj/tal_condition">TAL Condition</span>
                </td>
                <td i18n:domain="plone">
                  <span tal:condition="isActive" i18n:translate="">Yes</span>
                  <span tal:condition="not: isActive" i18n:translate="">No</span>
                </td>
                <td align="right">
                  <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
                </td>
              </tr>
              </tal:loop>
            </table>
        </tal:searchesCategories>
      </fieldset>

      <!-- Topics -->
      <a name="topics"></a>
      <fieldset tal:condition="python: 'topics' in context.objectIds('ATFolder')">
        <legend>
          <span i18n:translate="Topics" style="color: red;">Old topics</span>
        </legend>
        <p class="discreet" style="color: red;">This is kept for migration purpose, do not use anymore.</p><br />
        <table class="listing nosort" align="right" width="100%"
               tal:define="tFolder python:context.topics;
                           tFolderUrl tFolder/absolute_url" width="100%;">
          <tr>
            <th class="nosort" i18n:translate="listingheader_title">Title</th>
            <th class="nosort" i18n:translate="topic_linked_to_type">Linked to Meeting or MeetingItem?</th>
            <th class="nosort" i18n:translate="topic_search_script">Topic search script</th>
            <th class="nosort" i18n:translate="topic_tal_expression">Topic tal expression</th>
            <th class="nosort" width="50px" i18n:translate="heading_is_active">Active?</th>
            <th class="nosort" width="130px" i18n:translate="heading_actions">Actions</th>
          </tr>
          <tr tal:condition="python: not tFolder.objectValues('ATTopic')">
            <td colspan="5" align="center" i18n:translate="">no_topic_folder</td>
          </tr>
          <tal:loop repeat="obj python:tFolder.objectValues('ATTopic')">
          <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                          oddrow repeat/obj/odd;
                          classOddEven python: oddrow and 'even' or 'odd';"
              tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
              valign="top">
            <td>
              <a i18n:translate="" tal:attributes="href obj/absolute_url" tal:content="obj/Title"></a>
              <div class="discreet" tal:define="descr obj/Description" tal:condition="descr" tal:content="descr"></div>
            </td>
            <td><p i18n:translate="" i18n:domain="plone" tal:content="python: obj.getProperty('meeting_topic_type')">Meeting or Item</p></td>
            <td><p i18n:translate="" tal:content="python: obj.getProperty('topic_search_script')">Topic search script Id</p></td>
            <td><p i18n:translate="" tal:content="python: obj.getProperty('topic_tal_expression')">Meeting or Item</p></td>
            <td i18n:domain="plone">
              <span tal:condition="isActive" i18n:translate="">Yes</span>
              <span tal:condition="not: isActive" i18n:translate="">No</span>
            </td>
            <td align="right">
              <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
            </td>
          </tr>
          </tal:loop>
        </table>
      </fieldset>

    </tal:gui>

    <tal:mail condition="python: pageName=='mail'">
      <p i18n:translate="meetingconfig_mail_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('mailMode')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('mailFormat')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="34%"></td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('mailItemEvents')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('mailMeetingEvents')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
      </table>
    </tal:mail>

    <tal:advices condition="python: pageName=='advices'">
      <p i18n:translate="meetingconfig_advice_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top" colspan="3">
          <td tal:define="field python:here.getField('useAdvices')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('usedAdviceTypes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('defaultAdviceType')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td width="34%" tal:define="field python:here.getField('itemAdviceStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('itemAdviceEditStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('itemAdviceViewStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('enforceAdviceMandatoriness')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('enableAdviceInvalidation')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemAdviceInvalidateStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('adviceStyle')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('keepAccessToItemWhenAdviceIsGiven')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td>
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('defaultAdviceHiddenDuringRedaction')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('transitionReinitializingDelays')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('historizeItemDataWhenAdviceIsGiven')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td colspan="3">
            <fieldset tal:define="field python:here.getField('customAdvisers')">
              <legend>
                <span i18n:translate="PloneMeeting_label_customAdvisers"></span>
                <img tal:attributes="src string: $portal_url/questionMark.png;
                                     onClick python:'toggleDoc(\'customAdvisersDoc\')'"
                     style="cursor:pointer"/>
              </legend>
                  <div id="customAdvisersDoc" style="display:none">
                        <p class="discreet" i18n:translate="custom_advisers_full_descr" />
                      </div>
                  <span metal:use-macro="here/widgets/field/macros/view" />
            </fieldset>
          </td>
          <td>
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('itemPowerObserversStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingPowerObserversStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('itemRestrictedPowerObserversStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingRestrictedPowerObserversStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('itemBudgetInfosStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('powerAdvisersGroups')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('useCopies')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('selectableCopyGroups')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemCopyGroupsStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('hideItemHistoryCommentsToUsersOutsideProposingGroup')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('restrictAccessToSecretItems')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td>
          </td>
        </tr>
        <tr valign="top">
          <td>
          </td>
          <td tal:define="field python:here.getField('enableAnnexConfidentiality')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('annexConfidentialFor')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr>
          <td tal:define="field python:here.getField('enableAdviceConfidentiality')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('adviceConfidentialityDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('adviceConfidentialFor')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
      </table>
    </tal:advices>

    <tal:votes condition="python: pageName=='votes'">
      <p i18n:translate="meetingconfig_votes_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('useVotes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="34%" tal:define="field python:here.getField('votesEncoder')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('usedVoteValues')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('defaultVoteValue')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('voteCondition')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
      </table>
    </tal:votes>

    <tal:users condition="python: pageName=='users'">
    <p i18n:translate="meetingconfig_users_descr" class='pageNameDescr'></p>

    <tal:comment replace="nothing">Meeting users</tal:comment>
    <a name="meetingusers"></a>
    <fieldset>
      <legend>
        <span i18n:translate="users"></span>
        <img tal:attributes="src string: $portal_url/questionMark.png;
                             onClick python:'toggleDoc(\'usersDoc\')'"
             style="cursor:pointer"/>
      </legend>
      <div id="usersDoc" style="display:none">
        <p class="discreet" i18n:translate="meeting_users_descr" /><br />
      </div>
      <table class="listing nosort" width="100%"
            tal:define="mFolder python:context.meetingusers;
                        mFolderUrl mFolder/absolute_url;">
      <tr>
        <th class="nosort" width="20%" i18n:translate="listingheader_title">Title</th>
        <th class="nosort" width="20%" i18n:translate="plonemeeting_identifier">Identifier</th>
        <th class="nosort" width="20%" i18n:translate="PloneMeeting_label_duty">Duty</th>
        <th class="nosort" width="20%" i18n:translate="PloneMeeting_label_usages">Usages</th>
        <th class="nosort" width="50px" i18n:translate="heading_is_active">Active?</th>
        <th class="nosort" width="130px" i18n:translate="heading_actions">Actions</th>
      </tr>
      <tr tal:condition="python: not mFolder.objectValues('MeetingUser')">
        <td colspan="6" align="center" i18n:translate="">no_meeting_user</td>
      </tr>
      <tal:loop repeat="obj python:mFolder.objectValues('MeetingUser')">
        <tr tal:define="isActive python: here.portal_workflow.getInfoFor(obj, 'review_state') == 'active';
                        oddrow repeat/obj/odd;
                        classOddEven python: oddrow and 'even' or 'odd';"
            tal:attributes="class python: not isActive and classOddEven+' state-inactive' or classOddEven"
            valign="top">
        <td><a tal:attributes="href obj/absolute_url" tal:content="obj/Title"></a></td>
        <td tal:content="obj/getId"></td>
        <td tal:content="python: obj.getBilingual('duty')"></td>
        <td tal:define="usageIds obj/getUsages"
            tal:content="python: ', '.join([context.translate('meeting_user_usage_%s' % u, domain='PloneMeeting') for u in usageIds])">
        </td>
        <tal:comment replace="nothing">Active ?</tal:comment>
        <td i18n:domain="plone">
          <span tal:condition="isActive" i18n:translate="">Yes</span>
          <span tal:condition="not: isActive" i18n:translate="">No</span>
        </td>
        <td align="right">
          <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
        </td>
      </tr>
      </tal:loop>
      </table>

      <form name="addUserForm"
            tal:attributes="action python: context.absolute_url() + '/addUser'"
            tal:condition="isRealManager"
            style="text-align:right; padding-top: 0.5em;">
        <label for="userid" style="vertical-align: middle;" i18n:translate="plonemeeting_identifier"></label>
        <input type="text" name="userid"/>
        <input class="context" type="submit" value="add_object" i18n:attributes="value"/>
      </form>
    </fieldset>
    </tal:users>

    <tal:doc condition="python: pageName=='doc'">
    <p i18n:translate="meetingconfig_doc_descr" class='pageNameDescr'></p>

      <a name="podtemplates"></a>
      <fieldset>
        <legend>
         <span i18n:translate="PodTemplates"></span>
         <a href="#"
            class="link-overlay-pm"
            tal:condition="isRealManager"
            tal:attributes="href string:${context/podtemplates/absolute_url}/folder_factories">
          <img src="#" tal:attributes="src string: $portal_url/plus.png;" />
         </a>
        </legend>
        <p class="discreet" i18n:translate="pod_templates_descr"></p><br />
        <table class="listing nosort" align="right" width="100%"
               tal:define="pFolder python:context.podtemplates;
                           pFolderUrl pFolder/absolute_url" width="100%;">
          <tr>
            <th class="nosort" width="20px"></th>
            <th class="nosort" i18n:translate="listingheader_title">Title</th>
            <th class="nosort" width="50px"  i18n:translate="heading_is_active">Active?</th>
            <th class="nosort" width="130px"  i18n:translate="heading_actions">Actions</th>
          </tr>
          <tal:comment replace="nothing">No template is defined.</tal:comment>
          <tr tal:condition="python: not pFolder.objectValues()">
            <td colspan="4" align="center" i18n:translate="">no_pod_folder</td>
          </tr>
          <tal:loop repeat="obj python:pFolder.objectValues()">
          <tr tal:define="oddrow repeat/obj/odd;
                          classOddEven python: oddrow and 'even' or 'odd';"
             tal:attributes="class python: not obj.enabled and classOddEven+' state-inactive' or classOddEven"
             valign="top">
            <td align="center"><img tal:repeat="fmt obj/pod_formats"
                                    tal:attributes="src string: $portal_url/++resource++collective.documentgenerator/$fmt.png"/></td>
            <td>
                <a tal:attributes="href obj/absolute_url;">
                  <img src="#" tal:condition="python: obj.portal_type == 'DashboardPODTemplate'" tal:attributes="src string:${portal_url}/++resource++imio.dashboard/dashboardpodtemplate.png" />
                  <span tal:content="obj/Title" />
                </a>
                <div class="discreet" tal:define="descr obj/Description" tal:condition="descr" tal:content="descr"></div>
                <tal:additionalInformations
                    define="context python: obj;
                            excludedFields python: ('pod_formats', 'enabled', 'style_template', 'merge_templates')">
                    <metal:addtionalInformations use-macro="here/@@pm-macros/additionalInformations" />
                </tal:additionalInformations>
            </td>
            <td i18n:domain="plone">
              <span tal:condition="obj/enabled" i18n:translate="">Yes</span>
              <span tal:condition="not: obj/enabled" i18n:translate="">No</span>
            </td>
            <td align="right">
              <tal:actions replace="structure python: obj.restrictedTraverse('@@config_actions_panel')(showActions=False, showTransitions=False, showArrows=True)" />
            </td>
          </tr>
          </tal:loop>
        </table>
      </fieldset>
    </tal:doc>

    <div metal:define-macro="folderlisting">
      <tal:comment replace="nothing">Hide the folder_listing</tal:comment>
    </div>

    </tal:hideToNonManagers>

       </metal:main_macro>
    </metal:fill>
  </body>
</html>
