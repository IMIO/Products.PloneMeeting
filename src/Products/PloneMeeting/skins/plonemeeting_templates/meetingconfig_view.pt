<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="PloneMeeting">

  <body >
  <metal:title fill-slot="content-title">
    <h1 class="documentFirstHeading">
        <span tal:content="context/getName"></span>
        <metal:field use-macro="here/hs_macros/macros/hsLanguageSelector" />
    </h1>
  </metal:title>
  <metal:description fill-slot="content-description">
   <tal:comment replace="nothing">Just hide the description as shown by default by Plone</tal:comment>
  </metal:description>

  <metal:fill fill-slot="content-core">
    <metal:main_macro define-macro="body"
                      tal:define="mode python:'view';
                   pageName request/pageName|string:default;
                   member context/portal_plonemeeting/getUser;
                   schematas here/Schemata;
                   fieldsets python:[key for key in schematas.keys() if (key != 'metadata') and (schematas[key].editableFields(here, visible_only=True))];">

    <script language="javascript" tal:content="context/portal_plonemeeting/getJavascriptMessages"></script>
    <span tal:repeat="fieldset python: fieldsets + ['users', 'doc']">
      [
      <tal:otherFieldset condition="python: pageName!=fieldset"><a
        tal:attributes="href python:here.absolute_url()+'?pageName=%s'%fieldset" tal:condition="python: pageName!=fieldset">
        <span tal:content="fieldset" i18n:translate=""></span></a>
      </tal:otherFieldset>
      <tal:currentFieldset condition="python: pageName==fieldset"><b><span
        tal:content="fieldset" i18n:translate=""></span></b>
      </tal:currentFieldset>
      <tal:edit condition="python: fieldset in fieldsets">
      <input type="image" title="Edit" i18n:attributes="title" 
             style="cursor:pointer" class="imageInput" 
             tal:attributes="src string: $portal_url/edit.gif; 
                             onClick python: 'href: window.location=\'%s/base_edit?fieldset=%s\'' % (context.absolute_url(), fieldset)"/>
    </tal:edit>]
    </span><br/><br/>

    <tal:mainConfig condition="python: pageName=='default'">
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="25%" tal:define="field python:here.getField('assembly')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="25%" tal:define="field python:here.getField('signatures')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="25%" tal:define="field python:here.getField('certifiedSignatures')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="25%" tal:define="field python:here.getField('places')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('budgetDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('folderTitle')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <!-- I cannot use the standard macro for displaying this field because the
               widget condition prevents the widget from being displayed. -->
          <td tal:define="field python:here.getField('shortName')">
            <b i18n:translate="PloneMeeting_label_shortName"></b>:
            <span tal:content="context/getShortName"/>
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('isDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('lastItemNumber')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('lastMeetingNumber')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('yearlyInitMeetingNumber')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('configVersion')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
      </table>

    <tal:comment replace="nothing">Display custom fields</tal:comment>
    <tal:customFields define="customFields python: context.getCustomFields(2)"
                      condition="customFields">
    <br/>
    <fieldset>
      <legend i18n:translate="">tool_plonemeeting_misc</legend>
      <table width="100%" class="discreet">
        <tr valign="top" tal:repeat="fieldLine customFields">
          <td tal:repeat="field fieldLine">
            <tal:thereIsAField condition="field">
              <metal:field use-macro="here/widgets/field/macros/view" />
            </tal:thereIsAField>
          </td>
        </tr>
      </table>
    </fieldset>
    </tal:customFields>

    </tal:mainConfig>

    <tal:data condition="python: pageName=='data'">
      <p i18n:translate="meetingconfig_data_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('usedItemAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('historizedItemAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('recordItemHistoryStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('usedMeetingAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('historizedMeetingAttributes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('recordMeetingHistoryStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('useGroupsAsCategories')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('toDiscussSetOnItemInsert')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('toDiscussDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('toDiscussLateDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('toDiscussShownForLateItems')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemReferenceFormat')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('sortingMethodOnAddItem')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td colspan="2" tal:define="field python:here.getField('allItemTags')">
            <b i18n:translate="PloneMeeting_label_allItemTags"></b>:
            <span tal:content="python: ', '.join(context.getAllItemTags().split('\n'))" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('sortAllItemTags')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('xhtmlTransformFields')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('xhtmlTransformTypes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('publishDeadlineDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('freezeDeadlineDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('preMeetingDateDefault')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('useUserReplacements')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingConfigsToCloneTo')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
      </table>

      <tal:comment replace="nothing">Annex types</tal:comment>
      <a name="meetingfiletypes"></a>
      <fieldset>
        <legend>
         <span i18n:translate="MeetingFileTypes"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:attributes="onClick python: 'href: window.location=\'%s/meetingfiletypes/createObject?type_name=MeetingFileType\'' % context.absolute_url();
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"/>
        </legend>
      <table tal:define="fFolder python:context.meetingfiletypes;
                         fFolderUrl fFolder/absolute_url" width="100%">
        <tr valign="top">
          <td><p class="discreet" i18n:translate="meeting_file_types_descr"></p><br /></td>
        </tr>
        <tr>
          <td>
          <table class="vertical listing" align="right" width="100%">
            <tr>
              <th i18n:translate="listingheader_title"></th>
              <th width="50px" i18n:translate="group_is_active"></th>
              <th width="130px" i18n:translate="heading_actions"></th>
            </tr>
            <tr tal:condition="python: not fFolder.objectValues('MeetingFileType')">
              <td colspan="3" align="center" i18n:translate="">no_meeting_file_type</td>
            </tr>
            <tal:loop repeat="mft python:fFolder.objectValues('MeetingFileType')">
            <tr class="#" tal:define="isActive python: here.portal_workflow.getInfoFor(mft, 'review_state') == 'active'"
                          tal:attributes="class python: isActive and 'state-active' or 'state-inactive'">
              <td><img tal:attributes="src python: mft.absolute_url() + '/at_download/theIcon'"/>&nbsp;
                  <a tal:attributes="href mft/absolute_url" tal:content="mft/getName"></a>
              </td>
              <td i18n:domain="plone">
                <span tal:condition="isActive" i18n:translate="">Yes</span>
                <span tal:condition="not: isActive" i18n:translate="">No</span>
              </td>
              <td tal:define="moveUrl python: fFolderUrl + '/folder_position?position=%s&id=%s&template_id=../?pageName=data#meetingfiletypes'"
                  tal:condition="python: member.has_permission('Modify portal content', mft)" align="right">
                <!-- Edit the file type -->
                <form name="deleteFTForm" action="delete_givenuid">
                  <a tal:attributes="href python: mft.absolute_url() + '/edit'">
                    <img src="edit.gif" title="label_edit" i18n:attributes="title" />
                  </a>
                  <!-- Delete the file type -->
                  <input type="hidden" name="selected_uid" tal:attributes="value mft/UID" />
                  <img title="label_remove" i18n:attributes="title"
                       tal:attributes="src string:$portal_url/delete.png"
                       onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>
                <!-- Move the file type bottom -->
                <a tal:condition="python: fFolder.getObjectPosition(mft.id) < len(fFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('bottom', mft.id)">
                   <img src="arrowBottom.png" title="title_move_item_bottom" i18n:attributes="title" />
                </a>
                <!-- Move the file type down -->
                <a tal:condition="python: fFolder.getObjectPosition(mft.id) < len(fFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('down', mft.id)">
                   <img src="arrowDown.png" title="title_move_item_down" i18n:attributes="title" />
                </a>
                <!-- Move the file type item up -->
                <a tal:condition="python: fFolder.getObjectPosition(mft.id) > 0"
                   tal:attributes="href python: moveUrl % ('up', mft.id)">
                   <img src="arrowUp.png" title="title_move_item_up" i18n:attributes="title" />
                </a>
                <!-- Move the file type item top -->
                <a tal:condition="python: fFolder.getObjectPosition(mft.id) > 0"
                   tal:attributes="href python: moveUrl % ('top', mft.id)">
                   <img src="arrowTop.png" title="title_move_item_top" i18n:attributes="title" />
                </a>                
                </form>
              </td>
            </tr>
            </tal:loop>
            </table>
          </td>
        </tr>
      </table>
      </fieldset>

      <tal:comment replace="nothing">Categories</tal:comment>
      <a name="categories"></a>
      <fieldset>
        <legend>
         <span i18n:translate="Categories"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:attributes="onClick python: 'href: window.location=\'%s/categories/createObject?type_name=MeetingCategory\'' % context.absolute_url();
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"/>
        </legend>
      <table tal:define="cFolder python:context.categories;
                         cFolderUrl cFolder/absolute_url" width="100%">
        <tr valign="top">
          <td><p class="discreet" i18n:translate="categories_descr"></p><br /></td>
        </tr>
        <tr>
          <td>
          <table class="vertical listing" align="right" width="100%">
            <tr>
              <th i18n:translate="listingheader_title"></th>
              <th width="50px" i18n:translate="config_is_active"></th>
              <th width="130px" i18n:translate="heading_actions"></th>
            </tr>
            <tr tal:condition="python: not cFolder.objectValues('MeetingCategory')">
              <td colspan="3" align="center" i18n:translate="">no_category</td>
            </tr>
            <tal:loop repeat="categ python:cFolder.objectValues('MeetingCategory')">
            <tr class="#" tal:define="isActive python: here.portal_workflow.getInfoFor(categ, 'review_state') == 'active'"
                          tal:attributes="class python: isActive and 'state-active' or 'state-inactive'">
              <td><a tal:attributes="href categ/absolute_url" tal:content="categ/getName"></a>
              </td>
              <td i18n:domain="plone">
                <span tal:condition="isActive" i18n:translate="">Yes</span>
                <span tal:condition="not: isActive" i18n:translate="">No</span>
              </td>
              <td tal:define="moveUrl python: cFolderUrl + '/folder_position?position=%s&id=%s&template_id=../?pageName=data#categories'"
                  tal:condition="python: member.has_permission('Modify portal content', categ)" align="right">
                <!-- Edit the category -->
                <form name="deleteCatForm" action="delete_givenuid">
                <a tal:attributes="href python: categ.absolute_url() + '/edit'">
                  <img src="edit.gif" title="label_edit" i18n:attributes="title" />
                </a>
                <!-- Delete the category -->
                  <input type="hidden" name="selected_uid" tal:attributes="value categ/UID"/>
                    <img title="label_remove" i18n:attributes="title"
                         tal:attributes="src string:$portal_url/delete.png"
                         onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>
                <!-- Move the category bottom -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) < len(cFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('bottom', categ.id)">
                   <img src="arrowBottom.png" title="title_move_item_bottom" i18n:attributes="title" />
                </a>
                <!-- Move the category down -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) < len(cFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('down', categ.id)">
                   <img src="arrowDown.png" title="title_move_item_down" i18n:attributes="title" />
                </a>
                <!-- Move the item up -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) > 0"
                   tal:attributes="href python: moveUrl % ('up', categ.id)">
                   <img src="arrowUp.png" title="title_move_item_up" i18n:attributes="title" />
                </a>
                <!-- Move the item top -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) > 0"
                   tal:attributes="href python: moveUrl % ('top', categ.id)">
                   <img src="arrowTop.png" title="title_move_item_top" i18n:attributes="title" />
                </a>
                </form>
              </td>
            </tr>
            </tal:loop>
            </table>
          </td>
        </tr>
      </table>
      </fieldset>

      <tal:comment replace="nothing">Classifiers</tal:comment>
      <a name="classifiers"></a>
      <fieldset>
        <legend>
         <span i18n:translate="Classifiers"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:attributes="onClick python: 'href: window.location=\'%s/classifiers/createObject?type_name=MeetingCategory\'' % context.absolute_url();
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"/>
        </legend>
      <table tal:define="cFolder python:context.classifiers;
                         cFolderUrl cFolder/absolute_url" width="100%">
        <tr valign="top">
          <td><p class="discreet" i18n:translate="classifiers_descr"></p><br /></td>
        </tr>
        <tr>
          <td>
          <table class="vertical listing" align="right" width="100%">
            <tr>
              <th i18n:translate="listingheader_title"></th>
              <th width="20%" i18n:translate="PloneMeeting_label_categoryId"></th>
              <th width="50px" i18n:translate="group_is_active"></th>
              <th width="130px" i18n:translate="heading_actions"></th>
            </tr>
            <tr tal:condition="python: not cFolder.objectValues('MeetingCategory')">
              <td colspan="4" align="center" i18n:translate="">no_classifier</td>
            </tr>
            <tal:loop repeat="categ python:cFolder.objectValues('MeetingCategory')">
            <tr tal:define="isActive python: here.portal_workflow.getInfoFor(categ, 'review_state') == 'active'"
                tal:attributes="class python: isActive and 'state-active' or 'state-inactive'">
              <td tal:define="descr categ/Description">
                <a tal:attributes="href categ/absolute_url" tal:content="categ/getName"></a>
                <div class="discreet" tal:condition="descr" tal:content="descr"></div>
              </td>
              <td tal:content="categ/getCategoryId"></td>
              <td i18n:domain="plone">
                <span tal:condition="isActive" i18n:translate="">Yes</span>
                <span tal:condition="not: isActive" i18n:translate="">No</span>
              </td>
              <td tal:define="moveUrl python: cFolderUrl + '/folder_position?position=%s&id=%s&template_id=../?pageName=data#classifiers'"
                  tal:condition="python: member.has_permission('Modify portal content', categ)" align="right">
                <form name="deleteCatForm" action="delete_givenuid">
                <!-- Edit the category -->
                <a tal:attributes="href python: categ.absolute_url() + '/edit'">
                  <img src="edit.gif" title="label_edit" i18n:attributes="title" />
                </a>
                <!-- Delete the category -->
                  <input type="hidden" name="selected_uid" tal:attributes="value categ/UID"/>
                    <img title="label_remove" i18n:attributes="title"
                         tal:attributes="src string:$portal_url/delete.png"
                         onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>
                <!-- Move the category bottom -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) < len(cFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('bottom', categ.id)">
                   <img src="arrowBottom.png" title="title_move_item_bottom" i18n:attributes="title" />
                </a>
                <!-- Move the category down -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) < len(cFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('down', categ.id)">
                   <img src="arrowDown.png" title="title_move_item_down" i18n:attributes="title" />
                </a>
                <!-- Move the item up -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) > 0"
                   tal:attributes="href python: moveUrl % ('up', categ.id)">
                   <img src="arrowUp.png" title="title_move_item_up" i18n:attributes="title" />
                </a>
                <!-- Move the item top -->
                <a tal:condition="python: cFolder.getObjectPosition(categ.id) > 0"
                   tal:attributes="href python: moveUrl % ('top', categ.id)">
                   <img src="arrowTop.png" title="title_move_item_top" i18n:attributes="title" />
                </a>
                </form>
              </td>
            </tr>
            </tal:loop>
            </table>
          </td>
        </tr>
      </table>
      </fieldset>

      <!-- Recurring and template items -->
      <a name="recItems"></a>
      <fieldset>
        <legend>
         <span i18n:translate="RecurringItems"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:define="itemType python: 'MeetingItem' + context.getShortName()"
                tal:attributes="onClick python: 'href: window.location=\'%s/recurringitems/createObject?type_name=%s\'' % (context.absolute_url(), itemType);
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"/>
        </legend>
      <table tal:define="rFolder python:context.recurringitems;
                         rFolderUrl rFolder/absolute_url" width="100%">
        <tr valign="top">
          <td><p class="discreet" i18n:translate="recurring_items_descr"></p><br /></td>
        </tr>
        <tr>
          <td>
          <table class="vertical listing" align="right" width="100%">
            <tr>
              <th width="25%" i18n:translate="listingheader_title"></th>
              <th width="25%" i18n:translate="PloneMeeting_label_description"></th>
              <th width="15%" i18n:translate="PloneMeeting_label_usages"></th>
              <th width="25%" i18n:translate="PloneMeeting_label_meetingTransitionInsertingMe"></th>
              <th width="130px" i18n:translate="heading_actions"></th>
            </tr>
            <tr tal:condition="python: not rFolder.objectValues('MeetingItem')">
              <td colspan="5" align="center" i18n:translate="">no_recurring_item</td>
            </tr>
            <tr tal:repeat="item python:rFolder.objectValues('MeetingItem')">
              <td><a tal:attributes="href item/absolute_url" tal:content="item/getName"></a></td>
              <td tal:content="structure item/Description"></td>
              <td><ul><li tal:repeat="usage item/getUsages" tal:content="usage" i18n:translate=""></li></ul>
              </td>
              <td><span tal:content="python: 'as_recurring_item' in item.getUsages() and item.getMeetingTransitionInsertingMe() or '-'" i18n:domain="plone" i18n:translate="">Transition inserting me</span></td>
              <td align="right"
                  tal:define="moveUrl python: rFolderUrl + '/folder_position?position=%s&id=%s&template_id=../?pageName=data#recItems'"
                  tal:condition="python: member.has_permission('Modify portal content', item)">
                <form name="deleteItemForm" action="delete_givenuid">
                <!-- Edit the item -->
                <a tal:attributes="href python: item.absolute_url() + '/edit'">
                  <img src="edit.gif" title="label_edit" i18n:attributes="title" />
                </a>
                <!-- Delete the item -->
                  <input type="hidden" name="selected_uid" tal:attributes="value item/UID"/>
                    <img title="label_remove" i18n:attributes="title"
                         tal:attributes="src string:$portal_url/delete.png"
                         onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>
                <!-- Move the item bottom -->
                <a tal:condition="python: rFolder.getObjectPosition(item.id) < len(rFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('bottom', item.id)">
                   <img src="arrowBottom.png" title="title_move_item_bottom" i18n:attributes="title" />
                </a>
                <!-- Move the item down -->
                <a tal:condition="python: rFolder.getObjectPosition(item.id) < len(rFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('down', item.id)">
                   <img src="arrowDown.png" title="title_move_item_down" i18n:attributes="title" />
                </a>
                <!-- Move the item up -->
                <a tal:condition="python: rFolder.getObjectPosition(item.id) > 0"
                   tal:attributes="href python: moveUrl % ('up', item.id)">
                   <img src="arrowUp.png" title="title_move_item_up" i18n:attributes="title" />
                </a>
                <!-- Move the item top -->
                <a tal:condition="python: rFolder.getObjectPosition(item.id) > 0"
                   tal:attributes="href python: moveUrl % ('top', item.id)">
                   <img src="arrowTop.png" title="title_move_item_top" i18n:attributes="title" />
                </a>
                </form>
              </td>
            </tr>
            </table>
          </td>
        </tr>
      </table>
      </fieldset>
    </tal:data>

    <tal:workflow condition="python: pageName=='workflow'">
      <p i18n:translate="meetingconfig_workflow_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('itemWorkflow')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="34%" tal:define="field python:here.getField('itemConditionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('itemActionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('meetingWorkflow')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingConditionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingActionsInterface')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('workflowAdaptations')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('transitionsToConfirm')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
      </table>
    </tal:workflow>

    <tal:gui condition="python: pageName=='gui'">
      <p i18n:translate="meetingconfig_gui_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('itemTopicStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="34%" tal:define="field python:here.getField('meetingTopicStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('decisionTopicStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('maxShownMeetings')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('maxDaysDecisions')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingAppDefaultView')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('itemsListVisibleColumns')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemColumns')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('meetingColumns')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('maxShownAvailableItems')">
              <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('maxShownMeetingItems')">
              <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('maxShownLateItems')">
              <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('enableGotoPage')">
              <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('enableGotoItem')">
              <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('openAnnexesInSeparateWindows')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('toDoListTopics')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
          <td></td>
        </tr>
      </table>

      <!-- Topics -->
      <a name="topics"></a>
      <fieldset>
        <legend>
          <span i18n:translate="Topics"></span>
          <input type="image" style="cursor:pointer" class="imageInput"
                 tal:attributes="onClick python: 'href: window.location=\'%s/topics/createObject?type_name=Topic\'' % context.absolute_url();
                                 src string: $portal_url/plus.png"
                 title="add_object" i18n:attributes="title"/>
        </legend>

        <!-- Show the existing topics and a 'add new topic' button -->
        <table tal:define="tFolder python:context.topics;
                           tFolderUrl tFolder/absolute_url" width="100%">
        <tr valign="top">
         <td width="50%"><p class="discreet" i18n:translate="topics_descr"></p><br /></td>
        </tr>
        <tr valign="top">
          <td>
          <table class="vertical listing" align="right" width="100%">
            <tr>
              <th i18n:translate="listingheader_title"></th>
              <th i18n:translate="topic_linked_to_type">Linked to Meeting or MeetingItem?</th>
              <th i18n:translate="topic_search_script">Topic search script</th>
              <th i18n:translate="topic_tal_expression">Topic tal expression</th>
              <th width="50px" i18n:translate="pod_template_is_active"></th>
              <th width="130px" i18n:translate="heading_actions"></th>
            </tr>

            <!-- No topic is defined -->
            <tr tal:condition="python: not tFolder.objectValues('ATTopic')">
              <td colspan="3" align="center" i18n:translate="">no_topic_folder</td>
            </tr>

            <!-- List of defined topics -->
            <tal:loop repeat="topic python:tFolder.objectValues('ATTopic')">
            <tr tal:define="isActive python: here.portal_workflow.getInfoFor(topic, 'review_state') == 'active';
                            icon topic/getIcon"
                tal:attributes="class python: isActive and 'state-active' or 'state-inactive'"
                valign="top">

              <!-- Title -->
              <td><a i18n:translate="" tal:attributes="href topic/absolute_url" tal:content="topic/Title"></a></td>

              <!-- Linked to type -->
              <td><p i18n:translate="" tal:content="python: topic.getProperty('meeting_topic_type')">Meeting or Item</p></td>

              <!-- Linked search script -->
              <td><p i18n:translate="" tal:content="python: topic.getProperty('topic_search_script')">Topic search script Id</p></td>

              <!-- Display condition -->
              <td><p i18n:translate="" tal:content="python: topic.getProperty('topic_tal_expression')">Meeting or Item</p></td>

              <!-- Active ? -->
              <td i18n:domain="plone">
                <span tal:condition="isActive" i18n:translate="">Yes</span>
                <span tal:condition="not: isActive" i18n:translate="">No</span>
              </td>

              <!-- Actions -->
              <td tal:define="moveUrl python: tFolderUrl + '/folder_position?position=%s&id=%s&template_id=../#topics'"
                  tal:condition="python: member.has_permission('Modify portal content', topic)" align="right">
                <!-- Edit the topic-->
                <form name="deleteTopicForm" action="delete_givenuid">
                  <a tal:attributes="href python: topic.absolute_url() + '/edit'">
                    <img src="edit.gif" title="label_edit" i18n:attributes="title" />
                  </a>
                  <!-- Delete the topic -->
                  <input type="hidden" name="selected_uid" tal:attributes="value topic/UID" />
                  <img title="label_remove" i18n:attributes="title"
                       tal:attributes="src string:$portal_url/delete.png"
                       onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>
                <!-- Move the topic bottom -->
                <a tal:condition="python: tFolder.getObjectPosition(topic.id) < len(tFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('bottom', topic.id)">
                   <img src="arrowBottom.png" title="title_move_item_bottom" i18n:attributes="title" />
                </a>
                <!-- Move the topic down -->
                <a tal:condition="python: tFolder.getObjectPosition(topic.id) < len(tFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('down', topic.id)">
                   <img src="arrowDown.png" title="title_move_item_down" i18n:attributes="title" />
                </a>                
                <!-- Move the topic up -->
                <a tal:condition="python: tFolder.getObjectPosition(topic.id) > 0"
                   tal:attributes="href python: moveUrl % ('up', topic.id)">
                   <img src="arrowUp.png" title="title_move_item_up" i18n:attributes="title" />
                </a>
                <!-- Move the topic top -->
                <a tal:condition="python: tFolder.getObjectPosition(topic.id) > 0"
                   tal:attributes="href python: moveUrl % ('top', topic.id)">
                   <img src="arrowTop.png" title="title_move_item_top" i18n:attributes="title" />
                </a>                
                </form>
              </td>
            </tr>
            </tal:loop>
            </table>
          </td>
        </tr>
      </table>
      </fieldset>
    </tal:gui>

    <tal:mail condition="python: pageName=='mail'">
      <p i18n:translate="meetingconfig_mail_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('mailMode')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('mailFormat')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="34%"></td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('mailItemEvents')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('mailMeetingEvents')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
      </table>
    </tal:mail>

    <tal:tasks condition="python: pageName=='tasks'">
      <p i18n:translate="tasks_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('tasksMacro')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="34%" tal:define="field python:here.getField('taskCreatorRole')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%"></td>
        </tr>
      </table>
    </tal:tasks>

    <tal:advices condition="python: pageName=='advices'">
      <p i18n:translate="meetingconfig_advice_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top" colspan="3">
          <td tal:define="field python:here.getField('useAdvices')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td width="34%" tal:define="field python:here.getField('itemAdviceStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('itemAdviceEditStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('itemAdviceViewStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('usedAdviceTypes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('defaultAdviceType')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('enforceAdviceMandatoriness')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        <tr valign="top">
          <td tal:define="field python:here.getField('enableAdviceInvalidation')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('itemAdviceInvalidateStates')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('adviceStyle')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('useCopies')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('selectableCopyGroups')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
      </table>
    </tal:advices>

    <tal:votes condition="python: pageName=='votes'">
      <p i18n:translate="meetingconfig_votes_descr" class='pageNameDescr'></p><br />
      <table width="100%" class="discreet">
        <tr valign="top">
          <td width="33%" tal:define="field python:here.getField('useVotes')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="34%" tal:define="field python:here.getField('votesEncoder')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td width="33%" tal:define="field python:here.getField('usedVoteValues')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
        </tr>
        <tr valign="top">
          <td tal:define="field python:here.getField('defaultVoteValue')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td tal:define="field python:here.getField('voteCondition')">
            <span metal:use-macro="here/widgets/field/macros/view" />
          </td>
          <td></td>
        </tr>
      </table>
    </tal:votes>

    <tal:users condition="python: pageName=='users'">
    <p i18n:translate="meetingconfig_users_descr" class='pageNameDescr'></p>

    <tal:comment replace="nothing">Meeting users</tal:comment>
    <a name="meetingusers"></a>
    <fieldset>
      <legend>
        <span i18n:translate="users"></span>
      </legend>
      <table class="vertical listing" width="100%"
            tal:define="mFolder python:context.meetingusers;
                   mFolderUrl mFolder/absolute_url">
      <thead>
      <tr>
        <th width="20%" i18n:translate="listingheader_title"></th>
        <th width="20%" i18n:translate="plonemeeting_identifier"></th>
        <th width="20%" i18n:translate="PloneMeeting_label_duty"></th>
        <th width="20%" i18n:translate="PloneMeeting_label_usages"></th>
        <th width="50px" i18n:translate="pod_template_is_active"></th>
        <th width="130px" i18n:translate="heading_actions"></th>
      </tr>
      </thead>
      <tr tal:condition="python: not mFolder.objectValues('MeetingUser')">
        <td colspan="6" align="center" i18n:translate="">no_meeting_user</td>
      </tr>
      <tal:loop repeat="mUser python:mFolder.objectValues('MeetingUser')">
      <tr tal:define="isActive python: here.portal_workflow.getInfoFor(mUser, 'review_state') == 'active'"
          tal:attributes="class python: isActive and 'state-active' or 'state-inactive'">
        <td><a tal:attributes="href mUser/absolute_url" tal:content="mUser/Title"></a></td>
        <td tal:content="mUser/getId"></td>
        <td tal:content="python: mUser.getBilingual('duty')"></td>
        <td tal:define="usageIds mUser/getUsages"
            tal:content="python: ', '.join([context.translate('meeting_user_usage_%s' % u, domain='PloneMeeting') for u in usageIds])">
        </td>
        <tal:comment replace="nothing">Active ?</tal:comment>
        <td i18n:domain="plone">
          <span tal:condition="isActive" i18n:translate="">Yes</span>
          <span tal:condition="not: isActive" i18n:translate="">No</span>
        </td>
        <td align="right"
            tal:define="moveUrl python: mFolderUrl + '/folder_position?position=%s&id=%s&template_id=../?pageName=users'"
            tal:condition="python: member.has_permission('Modify portal content', mUser)">
          <form name="deleteItemForm" action="delete_givenuid">
          <!-- Edit the user -->
          <a tal:attributes="href python: mUser.absolute_url() + '/edit'">
            <img src="edit.gif" title="label_edit" i18n:attributes="title" />
          </a>
          <!-- Delete the user -->
            <input type="hidden" name="selected_uid" tal:attributes="value mUser/UID"/>
              <img title="label_remove" i18n:attributes="title"
                   tal:attributes="src string:$portal_url/delete.png"
                   onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>
          <!-- Move the user bottom -->
          <a tal:condition="python: mFolder.getObjectPosition(mUser.id) < len(mFolder.objectValues())-1"
             tal:attributes="href python: moveUrl % ('bottom', mUser.id)">
             <img src="arrowBottom.png" title="title_move_item_bottom" i18n:attributes="title" />
          </a>
          <!-- Move the user down -->
          <a tal:condition="python: mFolder.getObjectPosition(mUser.id) < len(mFolder.objectValues())-1"
             tal:attributes="href python: moveUrl % ('down', mUser.id)">
             <img src="arrowDown.png" title="title_move_item_down" i18n:attributes="title" />
          </a>
          <!-- Move the user up -->
          <a tal:condition="python: mFolder.getObjectPosition(mUser.id) > 0"
             tal:attributes="href python: moveUrl % ('up', mUser.id)">
             <img src="arrowUp.png" title="title_move_item_up" i18n:attributes="title" />
          </a>
          <!-- Move the user top -->
          <a tal:condition="python: mFolder.getObjectPosition(mUser.id) > 0"
             tal:attributes="href python: moveUrl % ('top', mUser.id)">
             <img src="arrowTop.png" title="title_move_item_up" i18n:attributes="title" />
          </a>
          </form>
        </td>
      </tr>
      </tal:loop>
      </table>

      <form name="addUserForm"
            tal:attributes="action python: context.absolute_url() + '/addUser'"
            style="text-align:right;">
        <label for="userid" i18n:translate="plonemeeting_identifier"></label>
        <input type="text" name="userid"/>
        <input class="context" type="submit" value="add_object" i18n:attributes="value"/>
      </form>
    </fieldset>
    </tal:users>

    <tal:doc condition="python: pageName=='doc'">
    <p i18n:translate="meetingconfig_doc_descr" class='pageNameDescr'></p>

      <a name="podtemplates"></a>
      <fieldset>
        <legend>
         <span i18n:translate="PodTemplates"></span>
         <input type="image" style="cursor:pointer" class="imageInput"
                tal:attributes="onClick python: 'href: window.location=\'%s/podtemplates/createObject?type_name=PodTemplate\'' % context.absolute_url();
                                src string: $portal_url/plus.png"
                title="add_object" i18n:attributes="title"/>
        </legend>
      <table tal:define="pFolder python:context.podtemplates;
                         pFolderUrl pFolder/absolute_url" width="100%">
        <tr valign="top">
          <td><p class="discreet" i18n:translate="pod_templates_descr"></p><br /></td>
        </tr>
        <tr>
          <td>
          <table class="vertical listing" align="right" width="100%">
            <tr>
              <th width="20px"></th>
              <th i18n:translate="listingheader_title"></th>
              <th width="50px"  i18n:translate="pod_template_is_active"></th>
              <th width="130px"  i18n:translate="heading_actions"></th>
            </tr>

            <tal:comment replace="nothing">No template is defined.</tal:comment>
            <tr tal:condition="python: not pFolder.objectValues('PodTemplate')">
              <td colspan="4" align="center" i18n:translate="">no_pod_folder</td>
            </tr>
            <tal:loop repeat="podt python:pFolder.objectValues('PodTemplate')">
            <tr tal:define="isActive python: here.portal_workflow.getInfoFor(podt, 'review_state') == 'active'"
                tal:attributes="class python: isActive and 'state-active' or 'state-inactive'">
              <td align="center"><img tal:define="fmt podt/getPodFormat"
                                      tal:attributes="src string: $portal_url/$fmt.png"/></td>
              <td><a tal:attributes="href podt/absolute_url" tal:content="podt/getName"></a></td>
              <td i18n:domain="plone">
                <span tal:condition="isActive" i18n:translate="">Yes</span>
                <span tal:condition="not: isActive" i18n:translate="">No</span>
              </td>
              <tal:comment replace="nothing">Actions</tal:comment>
              <td tal:define="moveUrl python: pFolderUrl + '/folder_position?position=%s&id=%s&template_id=../?pageName=doc#podTemplates'"
                  tal:condition="python: member.has_permission('Modify portal content', podt)" align="right">
                <tal:comment replace="nothing">Edit the pod template</tal:comment>
                <form name="deletePodTemplateForm" action="delete_givenuid">
                  <a tal:attributes="href python: podt.absolute_url() + '/edit'">
                    <img src="edit.gif" title="label_edit" i18n:attributes="title" />
                  </a>
                  <tal:comment replace="nothing">Delete it</tal:comment>
                  <input type="hidden" name="selected_uid" tal:attributes="value podt/UID" />
                  <img title="label_remove" i18n:attributes="title"
                       tal:attributes="src string:$portal_url/delete.png"
                       onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>
                <tal:comment replace="nothing">Move it bottom</tal:comment>
                <a tal:condition="python: pFolder.getObjectPosition(podt.id) < len(pFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('bottom', podt.id)">
                   <img src="arrowBottom.png" title="title_move_item_bottom" i18n:attributes="title" />
                </a>
                <tal:comment replace="nothing">Move it down</tal:comment>
                <a tal:condition="python: pFolder.getObjectPosition(podt.id) < len(pFolder.objectValues())-1"
                   tal:attributes="href python: moveUrl % ('down', podt.id)">
                   <img src="arrowDown.png" title="title_move_item_down" i18n:attributes="title" />
                </a>
                <tal:comment replace="nothing">Move it up</tal:comment>
                <a tal:condition="python: pFolder.getObjectPosition(podt.id) > 0"
                   tal:attributes="href python: moveUrl % ('up', podt.id)">
                   <img src="arrowUp.png" title="title_move_item_up" i18n:attributes="title" />
                </a>
                <tal:comment replace="nothing">Move it top</tal:comment>
                <a tal:condition="python: pFolder.getObjectPosition(podt.id) > 0"
                   tal:attributes="href python: moveUrl % ('top', podt.id)">
                   <img src="arrowTop.png" title="title_move_item_top" i18n:attributes="title" />
                </a>
                </form>
              </td>
            </tr>
            </tal:loop>
            </table>
          </td>
        </tr>
      </table>
      </fieldset>
    </tal:doc>

    <div metal:define-macro="folderlisting">
      <tal:comment replace="nothing">Hide the folder_listing</tal:comment>
    </div>

    <br/>
    <div metal:use-macro="here/hs_macros/macros/showTransitions"></div>

       </metal:main_macro>
    </metal:fill>
  </body>
</html>
