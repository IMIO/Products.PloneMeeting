<tal:comment replace="nothing">Displays advices as icons. Requires "meetingItem".</tal:comment>
<metal:icons metal:define-macro="advicesIcons" i18n:domain="PloneMeeting"
     tal:define="advicesByType meetingItem/getAdvicesByType;
                 adviceStyle python: meetingConfig.getUserParam('adviceStyle');
                 defaultAdviceType meetingConfig/getDefaultAdviceType;
                 adviceInfo python: meetingItem.getAdvicesToGive();
                 advicesToAdd python: adviceInfo[0];
                 advicesToEdit python: adviceInfo[1]">

  <table class="contentActionsAX no-style-table" cellpadding="0" cellspacing="0"
         tal:condition="advicesByType">
    <tr>
      <tal:comment replace="nothing">Icon for adding an advice</tal:comment>
      <td tal:condition="advicesToAdd" class="noPadding">
        <img i18n:attributes="title" title="advice_add" style="cursor:pointer"
             tal:attributes="src string:$portal_url/new.png;
                             onClick python: 'editAdvice(\'%s\', \'%s\', \'\', \'\')' % (meetingItem.UID(), u'??'.join([u'%s**%s' % (a[0], a[1]) for a in advicesToAdd]))" />
      </td>
      <tal:menu repeat="adviceType python: meetingConfig.getUsedAdviceTypes() + ('not_given',)">
      <td tal:condition="python: adviceType in advicesByType" class="noPadding">
        <dl class="actionMenuAX">
          <dt class="actionMenuHeaderAX pmLinks"><tal:comment replace="nothing">Icon with advice type</tal:comment>
              <a href="#">
                <img tal:attributes="src string:$portal_url/advice_${adviceStyle}_$adviceType.png; title adviceType"
                     i18n:attributes="title"/><span tal:replace="python: len(advicesByType[adviceType])"></span>
              </a>
          </dt>
          <dd class="actionMenuContentAX actionMenuContentAdvice">
            <ul style="cursor:default"> <tal:comment replace="nothing">List of group names</tal:comment>
              <li tal:repeat="advice python:advicesByType[adviceType]">
                <table class="no-style-table advices" cellpadding="2" cellspacing="2" width="100%"
                       tal:define="mayEdit python: advicesToEdit and (advice['id'] in advicesToEdit)">
                  <tr>
                    <td class="noPadding"> <tal:comment replace="nothing">Name is surrounded with () if optional.</tal:comment>
                    <span tal:condition="advice/optional">(</span><b tal:content="structure advice/name"></b><span tal:condition="advice/optional">)</span>
                    </td>
                    <td align="right" width="17px" class="noPadding" tal:condition="mayEdit"><img style="cursor:pointer"
                        tal:attributes="src string:$portal_url/delete.png;
                                        onClick python: 'deleteAdvice(\'%s\', \'%s\')' % (meetingItem.UID(), advice['id'])"/></td>
                    <td align="right" width="17px" class="noPadding" tal:condition="python: mayEdit or (advicesToAdd and advice.has_key('comment') and advice['comment'] and (advice['id'] in [a[0] for a in advicesToAdd]))"><img style="cursor:pointer"
                        tal:attributes="src string:$portal_url/edit.gif;
                                        onClick python: 'editAdvice(\'%s\', \'%s**%s\', \'%s\', \'%s\')' % (meetingItem.UID(), advice['id'], advice['name'], test(adviceType=='not_given', defaultAdviceType, adviceType), tool.forJs(advice['comment']))"/></td>
                  </tr>
                </table>
                <tal:details condition="python: (adviceType != 'not_given') and advice['comment']">
                  <i style="font-size: 95%" tal:content="structure advice/comment"></i><br/>
                </tal:details>
              </li>
            </ul>
          </dd>
        </dl>
      </td>
      </tal:menu>
    </tr>
  </table>
  <span tal:condition="not: advicesByType">-</span>
</metal:icons>
