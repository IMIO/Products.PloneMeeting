<tal:comment replace="nothing">Requires "itemOrMeeting", optional "showIcons"</tal:comment>

<div metal:define-macro="ploneMeetingActions" i18n:domain="PloneMeeting"
     tal:define="showIcons showIcons|nothing;
                 showArrows showArrows|nothing;
                 mayChangeOrder mayChangeOrder|nothing;
                 isItem python:itemOrMeeting.meta_type == 'MeetingItem';
                 inItemsList inItemsList|nothing;
                 uid itemOrMeeting/UID;
                 triggerFunction python: test(inItemsList, 'triggerTransitionFromList', 'triggerTransition')">

  <table class="no-style-table" tal:attributes="align python:test(showIcons, 'right', 'left')">
    <tr>
      <tal:comment replace="nothing">Available transitions</tal:comment>
      <td tal:repeat="transition python: context.portal_plonemeeting.getTransitionsFor(itemOrMeeting)"
          class="noPadding" align="left">
        <tal:transition define="transitionId python: transition['id'];
                                imageName python:  transitionId + '.png';
                                confirm python: str(transition['confirm']).lower()"
                        condition="transition/may_trigger">
          <tal:comment replace="nothing">Icon</tal:comment>
          <img style="cursor:pointer"
               tal:condition="python: showIcons and hasattr(portal, imageName)"
               tal:attributes="src string: $portal_url/$imageName;
                               title python: transition['title'];
                               onClick python:'%s(\'%s\',\'%s\',%s)' % (triggerFunction,uid,transition['id'],confirm)"/>
          <tal:comment replace="nothing">Button</tal:comment>
          <input class="#" type="button"
                 tal:condition="python: not (showIcons and hasattr(portal, imageName))"
                 tal:attributes="class string:hsButton hsButtonWF hsButtonWF_$transitionId;
                                 value python: transition['title'];
                                 size python: int(len(transition['title'])/1.2);
                                 onClick python:'%s(\'%s\',\'%s\',%s)' % (triggerFunction,uid,transition['id'],confirm)" />
        </tal:transition>
        <tal:comment replace="nothing">The user can't trigger this transition: we tell him why.</tal:comment>
        <input type="button" disabled
               tal:condition="not: transition/may_trigger" class="hsButton fakeButton"
               tal:attributes="value transition/title;
                               title transition/reason"
               i18n:attributes="value" />
      </td>

      <tal:comment replace="nothing">Arrows (only icons) for moving items up or down in a meeting</tal:comment>
      <td tal:condition="python: showArrows and mayChangeOrder" class="noPadding">
        <table class="no-style-table" cellspacing="0" cellpadding="0">
          <tr>
            <td tal:condition="python: itemOrMeeting.getItemNumber() &gt; 1" class="noPadding">
              <img name="moveUp" title="move_item_up" i18n:attributes="title" style="cursor:pointer"
                   tal:attributes="src string: $portal_url/arrowUp.png;
                                   onClick python:'moveMeetingItem(\'up\', \'%s\', null)' % itemOrMeeting.UID()"/>
            </td>
            <td tal:condition="python: itemOrMeeting.getItemNumber() &lt; totalNbOfItems" class="noPadding">
              <img name="moveDown" title="move_item_down" i18n:attributes="title" style="cursor:pointer"
                   tal:attributes="src string: $portal_url/arrowDown.png;
                                   onClick python:'moveMeetingItem(\'down\', \'%s\', null)' % itemOrMeeting.UID()"/>
            </td>
          </tr>
        </table>
      </td>

      <tal:comment replace="nothing">Delete icon/button</tal:comment>
      <td tal:condition="python: member.has_permission('Delete objects', itemOrMeeting) and itemOrMeeting.wfConditions().mayDelete()" class="noPadding">
        <form name="deleteUidForm" action="delete_givenuid">
            <input type="hidden" name="selected_uid" tal:attributes="value itemOrMeeting/UID" />
            <tal:comment replace="nothing">Icon</tal:comment>
            <img tal:condition="showIcons" i18n:attributes="title" title="Delete" i18n:domain="plone"
                 tal:attributes="src string: $portal_url/delete.png"
                 onClick="javascript:confirmDeleteObject(this)" style="cursor:pointer"/>

            <tal:comment replace="nothing">Button</tal:comment>
            <input tal:condition="not: showIcons" type="button" i18n:attributes="value" value="Delete" i18n:domain="plone"
                   onClick="javascript:confirmDeleteObject(this);" class="hsButton hsButtonAction hsButtonAction_delete"/>
        </form>
      </td>

      <tal:comment replace="nothing">Delete a meeting with its items</tal:comment>
      <td tal:condition="python: (itemOrMeeting.meta_type == 'Meeting') and member.has_permission('Delete objects', itemOrMeeting) and member.has_role('Manager')" class="noPadding">
        <form name="deleteWholeMeetingForm" action="delete_givenuid">
            <input type="hidden" name="selected_uid" tal:attributes="value itemOrMeeting/UID" />
            <input type="hidden" name="wholeMeeting" value="True"/>
            <tal:comment replace="nothing">Icon</tal:comment>
            <img tal:condition="showIcons" style="cursor:pointer"
                 title="delete_meeting_with_items" i18n:attributes="title"
                 tal:attributes="src string: $portal_url/delete_many.gif"
                 onClick="javascript:confirmDeleteObject(this, 'wholeMeeting')"/>

            <tal:comment replace="nothing">Button</tal:comment>
            <input tal:condition="not: showIcons" type="button" i18n:attributes="value"
                   value="delete_meeting_with_items"
                   onClick="javascript:confirmDeleteObject(this, 'wholeMeeting');" class="hsButton hsButtonAction hsButtonAction_deleteWholeMeeting"/>
        </form>
      </td>

      <tal:comment replace="nothing">Edit action</tal:comment>
      <td tal:condition="python: member.has_permission('Modify portal content', itemOrMeeting) and showIcons"
          class="noPadding">
        <tal:comment replace="nothing">Icon. We show this only in showIcons more, because if we are not in
            this mode, the "edit" tab is present so is is redundant.</tal:comment>
        <a tal:condition="showIcons"
           tal:attributes="href string:${itemOrMeeting/absolute_url}/edit">
          <img src="edit.gif" tal:attributes="src string:$portal_url/edit.gif" title="Edit" i18n:attributes="title" />
        </a>
      </td>

      <tal:comment replace="nothing">Object actions</tal:comment>
      <span>
      <td tal:repeat="action python: context.listObjectButtonsActions(itemOrMeeting)" class="noPadding">

          <tal:comment replace="nothing">Icon</tal:comment>
          <a tal:attributes="href python: action[0]" tal:condition="python: showIcons and action[1]">
            <img tal:attributes="src python: portal_url + '/' + action[1];
                                 title python: action[2];" i18n:attributes="title" />
          </a>
        <tal:comment replace="nothing">Button</tal:comment>
        <input class="#"
               tal:condition="python: not (showIcons and action[1])" type="button" i18n:attributes="value"
               tal:attributes="class python: 'hsButton hsButtonAction hsButtonAction_%s' % action[3];
                               onClick python: 'href: window.location=\'%s\'' % action[0];
                               value python: action[2];"/>
      </td>
      </span>
  </tr>

  </table>
</div>
