<tal:comment replace="nothing">Requires "obj".
     Optional: "relatedTo". If True, decision-related annexes are shown
               instead of item-related annexes.
               Extra css_class "extra_css_class" can be given to be applied on the icon <a> node.
               This makes it possible to display a actionMenuAX in a actionMenuAX and getting it working...</tal:comment>
<tal:defines i18n:domain="PloneMeeting"
             define="annexesByType view/getAnnexesByType;">

  <table tal:condition="annexesByType" cellpadding="0" cellspacing="0"
         class="contentActionsAX no-style-table" style="margin: 0;">
    <tr valign="top"
        tal:define="DateTime python: modules['DateTime'];
                    now python: DateTime.DateTime();
                    target python: view.cfg.getUserParam('openAnnexesInSeparateWindows', context.REQUEST) and '_blank' or '';
                    cssClasses python: 'contentActionsAX no-style-table';
                    global count python:0;
                    portal_url context/@@plone_portal_state/portal_url;
                    previewEnabled python: view.tool.getEnableAnnexPreview();
                    extra_css_class extra_css_class|nothing;">
      <td tal:condition="python: view.relatedTo == 'item_decision'">
        <span class="discreet" style="padding-left: 0.7em;"
              i18n:translate="AnnexesDecisionShort"></span>
        <span class="discreet">:</span>
      </td>
      <td tal:repeat="annexesGroup annexesByType" class="noPadding">
        <tal:comment replace="nothing">Several annexes of this type are present</tal:comment>
        <dl class="actionMenuAX"
            tal:define="imgUrl python:portal_url + '/' + annexesGroup[0]['iconUrl'];
                        global count python:count+1"
            tal:attributes="id python:'annexesMenu_' + str(count) + '_' + context.UID() + '_' + str(view.relatedTo)">
            <dt class="actionMenuHeaderAX pmLinks">
                <a href="#" class="#" tal:attributes="class extra_css_class">
                    <img tal:attributes="src imgUrl" />
                    <b tal:content="python: len(annexesGroup)" id="pmNoNewContent">
                    </b>
                </a>
          </dt>
          <dd class="actionMenuContentAX">
            <ul>
              <li tal:define="tool python: view.tool;
                              meetingConfig python: view.cfg;" class="pmLinks" tal:repeat="annex annexesGroup">
                <metal:withOrWithoutPreview use-macro="context/@@annexes-macros/withOrWithoutPreview" />
              </li>
            </ul>
          </dd>
        </dl>
      </td>
    </tr>
  </table>
</tal:defines>
