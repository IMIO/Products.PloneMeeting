<tal:defines define="conversionStatus view/conversionStatus;
                     tool python: view.tool;
                     cfg python: view.cfg;
                     previewEnabled tool/getEnableAnnexPreview;
                     target python: cfg.getUserParam('openAnnexesInSeparateWindows', view.request) and '_blank' or '';
                     portal_url view/portal_url;
                     annexInfo python: view.annexInfo;">
    <tal:withPreview define="isRealManager python: tool.isManager(context, realManagers=True);"
                     condition="previewEnabled">
       <a href="#"
          tal:attributes="href string:${portal_url}/${annexInfo/absolute_url}/download"
          title="Download annex"
          i18n:domain="PloneMeeting"
          i18n:attributes="title">
          <img style="float: right;"
               src="download_icon.png"
               tal:attributes="src string:${portal_url}/download_icon.png" />
       </a>
       <div class="annexTitle" tal:condition="python: conversionStatus == 'successfully_converted'">
         <span tal:replace="structure python: tool.getColoredLink(context,
                                                                  target=target,
                                                                  appendToUrl=view.appendToUrl('/documentviewer#document/p1'),
                                                                  additionalCSSClasses='classicpopup',
                                                                  annexInfo=annexInfo)"/>
       </div>
       <div class="annexTitle annexTitleNotPrintable" tal:condition="python: conversionStatus == 'under_conversion'"
            title="help_no_preview_available_under_conversion"
            i18n:domain="PloneMeeting"
            i18n:attributes="title">
         <img src="spinner.gif" tal:attributes="src string:${portal_url}/spinner.gif" width="16" height="16" />
         <span tal:content="annexInfo/Title" />
       </div>
       <div class="annexTitle annexTitleNotPrintable" tal:condition="python: conversionStatus == 'conversion_error' and not isRealManager"
            title="help_no_preview_available_conversion_error"
            i18n:domain="PloneMeeting"
            i18n:attributes="title">
         <span class="erroredConversion" tal:content="annexInfo/Title" />
       </div>
       <div class="annexTitle" tal:condition="python: conversionStatus == 'conversion_error' and isRealManager">
         <span tal:replace="structure python: tool.getColoredLink(context,
                                                                  target=target,
                                                                  appendToUrl=view.appendToUrl('/documentviewer'),
                                                                  additionalCSSClasses='annexTitleNotPrintable erroredConversion',
                                                                  tag_title='help_no_preview_available_conversion_error_manager',
                                                                  annexInfo=annexInfo)"/>
       </div>
       <div tal:condition="python: conversionStatus == 'not_convertable'"
             tal:content="annexInfo/Title"
             class="annexTitle annexTitleNotPrintable"
             title="help_no_preview_available" i18n:domain="PloneMeeting" i18n:attributes="title"/>

    </tal:withPreview>
    <tal:withoutPreview condition="not: previewEnabled">
       <span tal:replace="structure python: tool.getColoredLink(context, target=target, annexInfo=annexInfo)"/>
    </tal:withoutPreview>
</tal:defines>